
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>LOKO EXPRESS - Repas Universitaires</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #000000;
            --primary-light: #100f0f;
            --primary-dark: #280059;
            --secondary: #131315;
            --accent: #f10505;
            --gradient: linear-gradient(45deg, #000000, #5851DB, #9805f9, #000000, #1408f8, #FD1D1D, #F56040, #FFDC80);
            --wave-blue: #0066CC;
            --wave-orange: #FF6B00;
            --success: #28a745;
            --error: #dc3545;
            --warning: #ffc107;
            --surface: #FFFFFF;
            --background: #FAFAFA;
            --on-surface: #262626;
            --on-surface-light: #8E8E8E;
            --border: #DBDBDB;
            --shadow: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-lg: 0 8px 25px rgba(0,0,0,0.15);
            --radius: 12px;
            --radius-xl: 24px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: var(--background);
            color: var(--on-surface);
            line-height: 1.6;
            min-height: 100vh;
            touch-action: manipulation;
        }

        /* Image Zoom Modal */
        .image-zoom-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .image-zoom-modal.show {
            display: flex;
        }

        .image-zoom-content {
            position: relative;
            max-width: 95%;
            max-height: 95%;
        }

        .zoomed-image {
            width: 100%;
            height: auto;
            max-width: 100%;
            max-height: 90vh;
            object-fit: contain;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        .close-zoom-btn {
            position: absolute;
            top: -15px;
            right: -15px;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .image-info {
            position: absolute;
            bottom: -60px;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        /* Instagram-like Header */
        .header {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 12px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header-content {
            max-width: 975px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .logo-img {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 900;
            font-size: 14px;
        }

        .logo-text {
            font-size: 18px;
            font-weight: 400;
            color: var(--on-surface);
            font-family: 'Segoe UI', sans-serif;
            letter-spacing: -0.5px;
        }

        /* Header Actions */
        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .cart-icon {
            position: relative;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.3s ease;
            min-width: 44px;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cart-icon:hover {
            background: var(--background);
            transform: scale(1.1);
        }

        .cart-badge {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--accent);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            min-width: 20px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50px;
            transition: all 0.2s ease;
            min-height: 44px;
        }

        .user-profile:hover {
            background: var(--background);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid;
            border-image: var(--gradient) 1;
            background: var(--gradient);
        }

        .user-info h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--on-surface);
            margin: 0;
        }

        .user-info p {
            font-size: 12px;
            color: var(--on-surface-light);
            margin: 0;
        }

        /* Time Alert */
        .time-alert {
            background: linear-gradient(135deg, #ff6b6b, #ff8e53);
            color: white;
            padding: 16px;
            text-align: center;
            font-weight: 600;
            display: none;
            font-size: 14px;
        }

        /* Stories-like Navigation */
        .nav-section {
            padding: 16px 0;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
        }

        .nav-stories {
            max-width: 975px;
            margin: 0 auto;
            display: flex;
            gap: 16px;
            overflow-x: auto;
            padding: 0 16px;
            scrollbar-width: none;
        }

        .nav-stories::-webkit-scrollbar {
            display: none;
        }

        .nav-story {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 80px;
            text-decoration: none;
            color: inherit;
            padding: 8px;
            border-radius: 12px;
        }

        .nav-story:active {
            background: var(--background);
        }

        .nav-story-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            position: relative;
            padding: 2px;
        }

        .nav-story-avatar::before {
            content: '';
            position: absolute;
            inset: 2px;
            border-radius: 50%;
            background: var(--surface);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-story-text {
            font-size: 12px;
            font-weight: 400;
            color: var(--on-surface);
            text-align: center;
            line-height: 1.2;
        }

        /* Main Container */
        .container {
            max-width: 975px;
            margin: 0 auto;
            padding: 16px;
        }

        .main-feed {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        /* Instagram-like Post Cards */
        .post-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
            margin-bottom: 16px;
        }

        .post-header {
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border);
        }

        .post-category {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .category-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            font-weight: 600;
        }

        .category-info h3 {
            font-size: 16px;
            font-weight: 600;
            margin: 0;
        }

        .category-info p {
            font-size: 14px;
            color: var(--on-surface-light);
            margin: 0;
        }

        /* Grille alimentaire optimis√©e pour mobile */
        .food-grid {
            display: grid;
            gap: 1px;
            background: var(--border);
        }

        /* Responsive grid */
        @media (max-width: 480px) {
            .food-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 481px) and (max-width: 768px) {
            .food-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 769px) {
            .food-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            }
        }

        .food-item {
            position: relative;
            background: var(--surface);
            display: flex;
            flex-direction: column;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .food-item:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .food-item:active {
            transform: scale(0.98);
        }

        .food-item-image {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
            transition: all 0.3s ease;
            cursor: zoom-in;
        }

        .food-item-image:hover {
            opacity: 0.9;
        }

        .food-item-content {
            padding: 12px;
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .food-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--on-surface);
            line-height: 1.3;
        }

        .food-description {
            font-size: 12px;
            color: var(--on-surface-light);
            flex: 1;
            line-height: 1.4;
        }

        .food-price {
            font-size: 16px;
            font-weight: 700;
            color: var(--primary);
            margin: 8px 0;
        }

        .add-to-cart-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            min-height: 44px;
        }

        .add-to-cart-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .add-to-cart-btn:active {
            transform: translateY(0);
        }

        .add-to-cart-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Responsive text sizes */
        @media (max-width: 480px) {
            .food-title {
                font-size: 13px;
            }
            
            .food-description {
                font-size: 11px;
            }
            
            .food-price {
                font-size: 14px;
            }
            
            .add-to-cart-btn {
                padding: 10px 12px;
                font-size: 13px;
            }
            
            .food-item-content {
                padding: 10px;
            }
        }

        .post-actions {
            padding: 16px;
            border-top: 1px solid var(--border);
        }

        .action-buttons {
            display: flex;
            gap: 16px;
            margin-bottom: 8px;
        }

        .action-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 8px;
            min-width: 44px;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }

        .action-btn:hover {
            background: var(--background);
            transform: scale(1.1);
        }

        .action-btn:active {
            background: var(--border);
        }

        .action-btn.liked {
            color: red;
        }

        /* Modal styles optimized for mobile */
        .modal, .cart-modal, .degue-modal, .payment-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .payment-modal {
            z-index: 2000;
        }

        .modal.show, .cart-modal.show, .degue-modal.show, .payment-modal.show {
            display: flex;
        }

        .modal-content, .cart-modal-content, .degue-modal-content, .payment-modal-content {
            background: var(--surface);
            border-radius: var(--radius-xl);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        /* Styles pour le paiement Wave */
        .payment-header {
            background: linear-gradient(135deg, var(--wave-blue), var(--wave-orange));
            color: white;
            padding: 2rem;
            text-align: center;
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
        }

        .wave-logo {
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: var(--wave-blue);
        }

        .payment-body {
            padding: 2rem;
        }

        .payment-step {
            display: none;
        }

        .payment-step.active {
            display: block;
        }

        .step-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border);
        }

        .step-number {
            width: 40px;
            height: 40px;
            background: var(--wave-blue);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .payment-info {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            padding: 1.5rem;
            border-radius: var(--radius);
            margin-bottom: 2rem;
            border-left: 4px solid var(--wave-blue);
        }

        .payment-details {
            display: grid;
            gap: 1rem;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border);
        }

        .detail-row:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--wave-blue);
        }

        .wave-number {
            background: var(--wave-blue);
            color: white;
            padding: 1rem;
            border-radius: var(--radius);
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            margin: 1rem 0;
            letter-spacing: 1px;
        }

        .copy-btn {
            background: var(--wave-orange);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .upload-area {
            border: 3px dashed var(--border);
            border-radius: var(--radius);
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            margin: 1rem 0;
        }

        .upload-area:hover,
        .upload-area.dragover {
            border-color: var(--wave-blue);
            background: rgba(0, 102, 204, 0.05);
        }

        .upload-area.has-file {
            border-color: var(--success);
            background: rgba(40, 167, 69, 0.05);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--on-surface-light);
        }

        .file-input {
            display: none;
        }

        .preview-container {
            margin: 1rem 0;
            text-align: center;
        }

        .preview-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
        }

        .verification-status {
            margin: 1rem 0;
            padding: 1rem;
            border-radius: var(--radius);
            text-align: center;
            font-weight: 600;
        }

        .verification-status.loading {
            background: rgba(255, 193, 7, 0.1);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .verification-status.success {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .verification-status.error {
            background: rgba(220, 53, 69, 0.1);
            color: var(--error);
            border: 1px solid var(--error);
        }

        .verification-details {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1rem;
            margin: 1rem 0;
        }

        .verification-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
        }

        .verification-item .status-icon {
            font-size: 1.2rem;
        }

        .verification-item .status-icon.valid {
            color: var(--success);
        }

        .verification-item .status-icon.invalid {
            color: var(--error);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--wave-blue), var(--wave-orange));
            width: 0%;
            transition: width 0.3s ease;
        }

        /* S√©lection du mode de paiement */
        .payment-method-selection {
            margin: 1rem 0;
            padding: 1rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
        }

        .payment-method {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }

        .payment-method:hover,
        .payment-method.selected {
            border-color: var(--wave-blue);
            background: rgba(0, 102, 204, 0.05);
        }

        .payment-method-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--wave-blue), var(--wave-orange));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            font-weight: bold;
        }

        .payment-method-info h4 {
            font-size: 1rem;
            font-weight: 600;
            margin: 0 0 0.25rem 0;
        }

        .payment-method-info p {
            font-size: 0.875rem;
            color: var(--on-surface-light);
            margin: 0;
        }

        /* Touch-friendly buttons */
        .submit-btn, .checkout-btn, .btn {
            width: 100%;
            background: var(--gradient);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 48px;
            margin: 0.5rem 0;
        }

        .btn {
            background: linear-gradient(135deg, var(--wave-blue), var(--wave-orange));
        }

        .submit-btn:hover, .checkout-btn:hover, .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .submit-btn:active, .checkout-btn:active, .btn:active {
            transform: scale(0.98);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: var(--border);
            color: var(--on-surface);
        }

        /* Form inputs optimized for mobile */
        .form-input {
            width: 100%;
            padding: 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.2s ease;
            background: var(--surface);
            min-height: 48px;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(225, 48, 108, 0.1);
        }

        /* Close buttons */
        .close-btn, .close-cart-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            background: rgba(0, 0, 0, 0.1);
            border: none;
            color: var(--on-surface);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 44px;
            min-height: 44px;
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        /* Cart and other modal specific styles */
        .cart-items {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 16px;
        }

        .cart-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item-image {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            object-fit: cover;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .cart-item-price {
            font-size: 12px;
            color: var(--on-surface-light);
        }

        .remove-btn {
            background: none;
            border: none;
            color: var(--on-surface-light);
            cursor: pointer;
            padding: 8px;
            font-size: 20px;
            min-width: 44px;
            min-height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-btn:hover {
            background: var(--background);
            color: var(--accent);
        }

        /* Empty states */
        .empty-state {
            text-align: center;
            padding: 48px 16px;
            color: var(--on-surface-light);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .alert {
            padding: 1rem;
            border-radius: var(--radius);
            margin: 1rem 0;
        }

        .alert-info {
            background: rgba(0, 102, 204, 0.1);
            color: var(--wave-blue);
            border: 1px solid rgba(0, 102, 204, 0.3);
        }

        .alert-warning {
            background: rgba(255, 193, 7, 0.1);
            color: var(--warning);
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        /* Animations */
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .post-card {
            animation: slideUp 0.6s ease-out;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .cart-badge {
            animation: pulse 0.6s ease-out;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 0.5rem;
        }

        /* Improve touch targets */
        @media (max-width: 768px) {
            .nav-story {
                min-width: 90px;
            }
            
            .header-content {
                padding: 0 12px;
            }
            
            .container {
                padding: 12px;
            }
            
            .logo-text {
                font-size: 16px;
            }
        }

        /* Additional mobile optimizations */
        @media (max-width: 480px) {
            .modal-content, .cart-modal-content, .degue-modal-content, .payment-modal-content {
                max-height: 95vh;
                margin: 10px;
                border-radius: 16px;
            }
            
            .header {
                padding: 8px 0;
            }
            
            .nav-section {
                padding: 12px 0;
            }
            
            .post-header {
                padding: 12px;
            }
            
            .post-actions {
                padding: 12px;
            }
        }

        /* Prevent zoom on input focus on iOS */
        @media (max-width: 768px) {
            input[type="text"], 
            input[type="email"], 
            input[type="tel"], 
            textarea {
                font-size: 16px !important;
            }
        }

        /* Style pour d√™gu√™ options */
        .degue-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .degue-option:hover {
            background: var(--background);
            border-color: var(--primary);
        }

        .degue-option-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .degue-option-icon {
            font-size: 1.5rem;
        }

        .degue-option-details h4 {
            font-size: 1rem;
            font-weight: 600;
            margin: 0;
        }

        .degue-option-details p {
            font-size: 0.875rem;
            color: var(--on-surface-light);
            margin: 0;
        }

        .degue-option-price {
            font-size: 1rem;
            font-weight: 700;
            color: var(--primary);
        }

        /* Modal tabs */
        .modal-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
        }

        .modal-tab {
            flex: 1;
            padding: 1rem;
            border: none;
            background: var(--background);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .modal-tab.active {
            background: var(--surface);
            border-bottom: 2px solid var(--primary);
        }

        .tab-content {
            display: none;
            padding: 2rem;
        }

        .tab-content.active {
            display: block;
        }

        .modal-header {
            padding: 2rem;
            text-align: center;
            border-bottom: 1px solid var(--border);
        }

        .modal-header h2 {
            margin: 0 0 0.5rem 0;
            color: var(--primary);
        }

        .modal-header p {
            margin: 0;
            color: var(--on-surface-light);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--on-surface);
        }

        .photo-preview {
            display: none;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin: 1rem auto;
            border: 2px solid var(--border);
        }

        .cart-modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            position: relative;
        }

        .cart-modal-title {
            margin: 0;
            font-size: 1.25rem;
            color: var(--primary);
        }

        .cart-modal-body {
            padding: 1.5rem;
        }

        .cart-total {
            font-size: 1.25rem;
            font-weight: bold;
            color: var(--primary);
            text-align: center;
            padding: 1rem 0;
            border-top: 2px solid var(--border);
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <!-- Time Alert -->
    <div class="time-alert" id="time-alert">
        ‚è∞ Les commandes sont ferm√©es. Revenez entre 18h00 et 10h00 pour commander.
    </div>

    <!-- Profile Modal -->
    <div class="modal" id="profile-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ú® Bienvenue sur LOKO EXPRESS</h2>
                <p>Cr√©ez votre profil pour d√©couvrir nos d√©licieux repas</p>
            </div>
            
            <div class="modal-tabs">
                <button class="modal-tab active" onclick="showTab('profile-tab')">üë§ Profil</button>
                <button class="modal-tab" onclick="showTab('contact-tab')">üìû Contact</button>
                <button class="modal-tab" onclick="showTab('share-tab')">üîó Partager</button>
            </div>

            <!-- Onglet Profil -->
            <div id="profile-tab" class="tab-content active">
                <form id="profile-form">
                    <div class="form-group">
                        <label for="profile-lastname">Nom *</label>
                        <input type="text" class="form-input" id="profile-lastname" required placeholder="Votre nom de famille">
                    </div>
                    <div class="form-group">
                        <label for="profile-firstname">Pr√©nom *</label>
                        <input type="text" class="form-input" id="profile-firstname" required placeholder="Votre pr√©nom">
                    </div>
                    <div class="form-group">
                        <label for="profile-email">Email ou WhatsApp *</label>
                        <input type="text" class="form-input" id="profile-email" required placeholder="contact@exemple.com ou +225...">
                    </div>
                    <div class="form-group">
                        <label for="profile-photo">Photo de profil (optionnel)</label>
                        <input type="file" class="form-input" id="profile-photo" accept="image/*">
                        <img id="profile-photo-preview" class="photo-preview">
                    </div>
                    <button type="submit" class="submit-btn">
                        ‚úÖ Cr√©er mon profil et commencer
                    </button>
                </form>
            </div>

            <!-- Onglet Contact -->
            <div id="contact-tab" class="tab-content">
                <div class="empty-state">
                    <div class="empty-state-icon">üìû</div>
                    <h3>Contactez-nous</h3>
                    <p>Nous sommes l√† pour vous aider !</p>
                </div>
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    <a href="https://wa.me/2250719983044?text=Bonjour%20LOKO%20Express%20!" 
                       target="_blank" 
                       style="background: linear-gradient(135deg, #25D366, #128C7E); color: white; padding: 1rem; text-decoration: none; border-radius: 12px; text-align: center; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                        üí¨ WhatsApp: 07 19 98 30 44
                    </a>
                    <a href="tel:0719983044" 
                       style="background: var(--gradient); color: white; padding: 1rem; text-decoration: none; border-radius: 12px; text-align: center; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                        üìû Appeler maintenant
                    </a>
                </div>
            </div>

            <!-- Onglet Partager -->
            <div id="share-tab" class="tab-content">
                <div class="empty-state">
                    <div class="empty-state-icon">üéâ</div>
                    <h3>Invitez vos amis</h3>
                    <p>Partagez LOKO EXPRESS avec vos proches</p>
                </div>
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    <a href="https://wa.me/?text=D√©couvre%20LOKO%20Express%20pour%20tes%20repas%20:%20https://loko-express.vercel.app/" 
                       target="_blank"
                       style="background: linear-gradient(135deg, #25D366, #128C7E); color: white; padding: 1rem; text-decoration: none; border-radius: 12px; text-align: center; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                        üíö Partager sur WhatsApp
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://loko-express.vercel.app/" 
                       target="_blank"
                       style="background: linear-gradient(135deg, #1877F2, #4267B2); color: white; padding: 1rem; text-decoration: none; border-radius: 12px; text-align: center; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                        üëç Partager sur Facebook
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Orders Modal -->
    <div class="modal" id="orders-modal">
        <div class="modal-content">
            <div class="modal-header">
                <button class="close-btn" onclick="toggleOrders()">&times;</button>
                <h2>üßæ Mes Commandes</h2>
                <p>Historique de vos commandes r√©centes</p>
            </div>
            <div style="padding: 2rem;">
                <div id="orders-list">
                    <div class="empty-state">
                        <div class="empty-state-icon">üõí</div>
                        <h3>Aucune commande</h3>
                        <p>Vos commandes appara√Ætront ici</p>
                    </div>
                </div>
                <button onclick="clearOrders()" class="submit-btn" style="background: linear-gradient(135deg, #dc3545, #c82333); margin-top: 1rem;">
                    üóëÔ∏è Vider l'historique
                </button>
            </div>
        </div>
    </div>

    <!-- Degu√® Selection Modal -->
    <div class="degue-modal" id="degue-modal">
        <div class="degue-modal-content">
            <div class="degue-modal-header">
                <h3 id="degue-modal-title">ü•õ Choisir votre format de D√™gu√™</h3>
                <p>S√©lectionnez la taille qui vous convient</p>
            </div>
            <div class="degue-options" id="degue-options">
                <!-- Les options seront g√©n√©r√©es dynamiquement -->
            </div>
            <div style="padding: 0 2rem 2rem;">
                <button onclick="closeDegueModal()" style="width: 100%; background: var(--border); color: var(--on-surface); border: none; padding: 1rem; border-radius: 8px; cursor: pointer;">
                    Annuler
                </button>
            </div>
        </div>
    </div>

    <!-- Cart Modal -->
    <div class="cart-modal" id="cart-modal">
        <div class="cart-modal-content">
            <div class="cart-modal-header">
                <h3 class="cart-modal-title">üõí Mon Panier</h3>
                <button class="close-cart-btn" onclick="toggleCart()">&times;</button>
            </div>
            <div class="cart-modal-body">
                <div class="cart-items" id="cart-items">
                    <div class="empty-state">
                        <div class="empty-state-icon">üõí</div>
                        <p>Votre panier est vide</p>
                    </div>
                </div>
                
                <div class="cart-total" id="cart-total">
                    Total: 0 FCFA
                </div>
                
                <!-- S√©lection du mode de paiement -->
                <div class="payment-method-selection">
                    <h4 style="margin-bottom: 1rem;">Choisissez votre mode de paiement :</h4>
                    
                    <div class="payment-method selected" onclick="selectPaymentMethod('cash')" id="cash-method">
                        <div class="payment-method-icon">üí∞</div>
                        <div class="payment-method-info">
                            <h4>Paiement √† la livraison</h4>
                            <p>Payez en esp√®ces lors de la r√©ception</p>
                        </div>
                    </div>
                    
                    <div class="payment-method" onclick="selectPaymentMethod('wave')" id="wave-method">
                        <div class="payment-method-icon">W</div>
                        <div class="payment-method-info">
                            <h4>Paiement Wave</h4>
                            <p>Paiement mobile s√©curis√© avec v√©rification automatique</p>
                        </div>
                    </div>
                </div>
                
                <form id="order-form">
                    <button type="submit" class="checkout-btn" id="checkout-btn">
                        üéØ Commander maintenant
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de paiement Wave -->
    <div class="payment-modal" id="payment-modal">
        <div class="payment-modal-content">
            <button class="close-btn" onclick="closePaymentModal()">&times;</button>
            
            <div class="payment-header">
                <div class="wave-logo">W</div>
                <h2>Paiement Wave</h2>
                <p>Paiement s√©curis√© avec v√©rification automatique</p>
            </div>

            <div class="payment-body">
                <!-- √âtape 1: Informations de paiement -->
                <div class="payment-step active" id="step-1">
                    <div class="step-header">
                        <div class="step-number">1</div>
                        <div>
                            <h3>Informations de paiement</h3>
                            <p>D√©tails de votre commande</p>
                        </div>
                    </div>

                    <div class="payment-info">
                        <div class="payment-details">
                            <div class="detail-row">
                                <span>Commande:</span>
                                <span id="order-code-payment">#LE001234</span>
                            </div>
                            <div class="detail-row">
                                <span>Articles:</span>
                                <span id="order-items-payment">-</span>
                            </div>
                            <div class="detail-row">
                                <span>Total √† payer:</span>
                                <span id="order-total-payment">0 FCFA</span>
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-info">
                        üì± <strong>Instructions:</strong><br>
                        1. Ouvrez votre application Wave<br>
                        2. Transf√©rez le montant exact vers le num√©ro ci-dessous<br>
                        3. Prenez une capture d'√©cran de la confirmation<br>
                        4. T√©l√©chargez la capture dans l'√©tape suivante
                    </div>

                    <div class="wave-number" id="wave-number">
                        üì± +225 07 19 98 30 44
                        <button class="copy-btn" onclick="copyWaveNumber()" style="margin-left: 1rem; padding: 0.5rem 1rem;">
                            üìã Copier
                        </button>
                    </div>

                    <button class="btn" onclick="nextStep(2)">
                        ‚úÖ J'ai effectu√© le paiement
                    </button>
                </div>

                <!-- √âtape 2: Upload de la capture -->
                <div class="payment-step" id="step-2">
                    <div class="step-header">
                        <div class="step-number">2</div>
                        <div>
                            <h3>Preuve de paiement</h3>
                            <p>T√©l√©chargez votre capture d'√©cran</p>
                        </div>
                    </div>

                    <div class="upload-area" onclick="document.getElementById('screenshot-input').click()">
                        <div class="upload-icon">üì∑</div>
                        <h4>Cliquez pour s√©lectionner votre capture</h4>
                        <p>Ou glissez-d√©posez votre image ici</p>
                        <input type="file" id="screenshot-input" class="file-input" accept="image/*">
                    </div>

                    <div class="preview-container" id="preview-container" style="display: none;">
                        <img id="preview-image" class="preview-image" alt="Aper√ßu">
                    </div>

                    <div class="alert alert-warning">
                        ‚ö†Ô∏è <strong>Important:</strong> La capture doit clairement montrer:<br>
                        ‚Ä¢ Le num√©ro de transaction<br>
                        ‚Ä¢ Le montant exact<br>
                        ‚Ä¢ Le destinataire (GROUPE EXPRESS)<br>
                        ‚Ä¢ La date et l'heure du paiement
                    </div>

                    <button class="btn" onclick="verifyPayment()" id="verify-btn" disabled>
                        üîç V√©rifier le paiement
                    </button>
                    <button class="btn btn-secondary" onclick="nextStep(1)">
                        ‚Üê Retour
                    </button>
                </div>

                <!-- √âtape 3: V√©rification -->
                <div class="payment-step" id="step-3">
                    <div class="step-header">
                        <div class="step-number">3</div>
                        <div>
                            <h3>V√©rification en cours</h3>
                            <p>Analyse automatique de votre capture</p>
                        </div>
                    </div>

                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>

                    <div class="verification-status loading" id="verification-status">
                        <div class="spinner"></div>
                        Analyse de la capture d'√©cran en cours...
                    </div>

                    <div class="verification-details" id="verification-details" style="display: none;">
                        <h4>D√©tails de v√©rification:</h4>
                        <div class="verification-item">
                            <span>Num√©ro de transaction:</span>
                            <span id="transaction-id">-</span>
                            <span class="status-icon" id="transaction-status">‚è≥</span>
                        </div>
                        <div class="verification-item">
                            <span>Montant:</span>
                            <span id="amount-found">-</span>
                            <span class="status-icon" id="amount-status">‚è≥</span>
                        </div>
                        <div class="verification-item">
                            <span>Destinataire:</span>
                            <span id="recipient-found">-</span>
                            <span class="status-icon" id="recipient-status">‚è≥</span>
                        </div>
                        <div class="verification-item">
                            <span>Date/Heure:</span>
                            <span id="datetime-found">-</span>
                            <span class="status-icon" id="datetime-status">‚è≥</span>
                        </div>
                    </div>
                </div>

                <!-- √âtape 4: R√©sultat -->
                <div class="payment-step" id="step-4">
                    <div class="step-header">
                        <div class="step-number">4</div>
                        <div>
                            <h3 id="result-title">R√©sultat</h3>
                            <p id="result-subtitle">-</p>
                        </div>
                    </div>

                    <div class="verification-status" id="final-status">
                        -
                    </div>

                    <div id="success-actions" style="display: none;">
                        <button class="btn" onclick="confirmWaveOrder()">
                            üéâ Valider ma commande
                        </button>
                    </div>

                    <div id="error-actions" style="display: none;">
                        <button class="btn" onclick="nextStep(2)">
                            üîÑ R√©essayer avec une autre capture
                        </button>
                        <button class="btn btn-secondary" onclick="contactSupport()">
                            üìû Contacter le support
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Header Instagram-style -->
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo-img">GE</div>
                <div class="logo-text">GROUPE EXPRESS</div>
            </div>
            
            <div class="header-actions">
                <button class="cart-icon" onclick="toggleCart()" id="cart-button">
                    üõí
                    <span class="cart-badge" id="cart-badge" style="display: none;">0</span>
                </button>
                
                <div class="user-profile" onclick="openProfile()" id="user-profile" style="display: none;">
                    <img src="https://via.placeholder.com/32x32/E1306C/white?text=U" alt="Avatar" class="user-avatar" id="user-avatar">
                    <div class="user-info">
                        <h4 id="user-name">Utilisateur</h4>
                        <p>Voir le profil</p>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Stories-like Navigation -->
    <section class="nav-section">
        <div class="nav-stories">
            <div class="nav-story" onclick="showAbout()">
                <div class="nav-story-avatar">‚ÑπÔ∏è</div>
                <div class="nav-story-text">√Ä propos</div>
            </div>
            <a href="fournisseur.html" class="nav-story">
                <div class="nav-story-avatar">‚ö°</div>
                <div class="nav-story-text">Fournisseur</div>
            </a>
            <div class="nav-story" onclick="toggleOrders()">
                <div class="nav-story-avatar">üßæ</div>
                <div class="nav-story-text">Commandes</div>
            </div>
            <a href="actualit√©.html" class="nav-story">
                <div class="nav-story-avatar">‚ö°</div>
                <div class="nav-story-text">Express Union</div>
            </a>
        </div>
    </section>
    <div class="container">
        <!-- Main Feed -->
        <div class="main-feed">
           <!-- Cat√©gorie A - P√¢tes & Petit pois -->
<div class="post-card">
    <div class="post-header">
        <div class="post-category">
            <div class="category-avatar">üçù</div>
            <div class="category-info">
                <h3>P√¢tes & Petit pois</h3>
                <p>Les classiques revisit√©s</p>
            </div>
        </div>
    </div>
    
    <div class="food-grid">
        <div class="food-item">
            <img src="image/spaghetti rognon.jpg" alt="Spaghetti rognon" class="food-item-image">
            <div class="food-item-content">
                <div class="food-title">Spaghetti rognon</div>
                <div class="food-description">Spaghetti pr√©par√© avec du rognon</div>
                <div class="food-price">500 FCFA</div>
                <button class="add-to-cart-btn" onclick="promptAddToCart('Spaghetti rognon', 500, 'A')">
                    üõí Ajouter au panier
                </button>
            </div>
        </div>
        
        <div class="food-item">
            <img src="image/spaghet foi.jpg" alt="Spaghetti foi" class="food-item-image">
            <div class="food-item-content">
                <div class="food-title">Spaghetti foi</div>
                <div class="food-description">Spaghetti pr√©par√© avec du foie</div>
                <div class="food-price">500 FCFA</div>
                <button class="add-to-cart-btn" onclick="promptAddToCart('Spaghetti foi', 500, 'A')">
                    üõí Ajouter au panier
                </button>
            </div>
        </div>

        <div class="food-item">
            <img src="image/spaghetti viande.jpg" alt="Spaghetti √† la viande" class="food-item-image">
            <div class="food-item-content">
                <div class="food-title">Spaghetti √† la viande</div>
                <div class="food-description">Spaghetti avec de la viande hach√©e</div>
                <div class="food-price">500 FCFA</div>
                <button class="add-to-cart-btn" onclick="promptAddToCart('Spaghetti √† la viande', 500, 'A')">
                    üõí Ajouter au panier
                </button>
            </div>
        </div>

        <div class="food-item">
            <img src="image/spagheti oeuf grilll.jpg" alt="Spaghetti oeuf griller" class="food-item-image">
            <div class="food-item-content">
                <div class="food-title">spagheti oeuf grill√©</div>
                <div class="food-description">Spaghetti + oeuf grill√©</div>
                <div class="food-price">750 FCFA</div>
                <button class="add-to-cart-btn" onclick="promptAddToCart('Spaghetti oeuf grill√©', 750, 'A')">
                    üõí Ajouter au panier
                </button>
            </div>
        </div>

        <div class="food-item">
           <img src="image/petit poid.jpg" alt="Petit pois au rognon" class="food-item-image">
            <div class="food-item-content">
                <div class="food-title">Petit pois rognon</div>
                <div class="food-description">Petit pois accompagn√© de rognon</div>
                <div class="food-price">1000 fcfa </div>
                <button class="add-to-cart-btn" onclick="promptAddToCart('Petit pois rognon', 1000, 'A')">
                    üõí Ajouter au panier
                </button>
            </div>
        </div>

        <div class="food-item">
            <img src="image/petit poid rogno,.jpg" alt="Petit pois au rognon" class="food-item-image">
            <div class="food-item-content">
                <div class="food-title">Petit pois au rognon</div>
                <div class="food-description">Petit pois avec du rognon</div>
                <div class="food-price">1000 FCFA</div>
                <button class="add-to-cart-btn" onclick="promptAddToCart('Petit pois au rognon', 1000, 'A')">
                    üõí Ajouter au panier
                </button>
            </div>
        </div>
    </div>
    
    <div class="post-actions">
    <div class="action-buttons">
        <button class="action-btn" onclick="likePost(this, 'pasta-post')">‚ù§Ô∏è</button>
        <button class="action-btn" onclick="commentPost('pasta-post')">üí¨</button>
        <button class="action-btn" onclick="showComments('pasta-post')">üëÅÔ∏è</button>
    </div>
    <p style="font-size: 0.875rem; color: var(--on-surface-light); margin: 0;" id="pasta-post-likes">
        <strong><span class="like-count">GROUPE EXPRESS</span> personnes</strong> aiment ces plats
    </p>
</div>
<!-- Cat√©gorie B - Tch√®pe -->
<div class="post-card">
    <div class="post-header">
        <div class="post-category">
            <div class="category-avatar">üçö</div>
            <div class="category-info">
                <h3>Tch√®pes</h3>
                <p>Nos plats de tch√®pe savoureux</p>
            </div>
        </div>
    </div>
    
    <div class="food-grid">
        <div class="food-item">
            <img src="image/tchep poisson.jpg" alt="Tch√®pe au poisson" class="food-item-image">
            <div class="food-item-content">
                <div class="food-title">Tch√®pe au poisson</div>
                <div class="food-description">Tch√®pe accompagn√© de poisson frais</div>
                <div class="food-price">500 FCFA</div>
                <button class="add-to-cart-btn" onclick="promptAddToCart('tch√®pe au poisson', 500, 'B')">
                    üõí Ajouter au panier
                </button>
            </div>
        </div>
        
        <div class="food-item">
            <img src="image/tcheo.jpg" alt="Tch√®pe au poulet" class="food-item-image">
            <div class="food-item-content">
                <div class="food-title">Tch√®pe au poulet</div>
                <div class="food-description">Tch√®pe au poulet</div>
                <div class="food-price">1000 FCFA</div>
                <button class="add-to-cart-btn" onclick="promptAddToCart('Tch√®pe au poulet', 1000, 'B')">
                    üõí Ajouter au panier
                </button>
            </div>
        </div>
    </div>
    
    <div class="post-actions">
        <div class="action-buttons">
            <button class="action-btn" onclick="likePost(this, 'tchepe-post')">‚ù§Ô∏è</button>
            <button class="action-btn" onclick="commentPost('tchepe-post')">üí¨</button>
            <button class="action-btn">üì§</button>
        </div>
        <p style="font-size: 0.875rem; color: var(--on-surface-light); margin: 0;" id="tchepe-post-likes">
            <strong><span class="like-count">GROUPE EXPRESS</span> personnes</strong> aiment ces plats
        </p>
    </div>
</div>

<!-- Cat√©gorie C - RIZ -->
<div class="post-card">
    <div class="post-header">
        <div class="post-category">
            <div class="category-avatar">üçõ</div>
            <div class="category-info">
                <h3>RIZ</h3>
                <p>D√©couvrez nos plats de riz</p>
            </div>
        </div>
    </div>
    
    <div class="food-grid">
        <div class="food-item">
            <img src="image/riz sauc e.jpg" alt="Riz sauce arachide" class="food-item-image">
            <div class="food-item-content">
                <div class="food-title">Riz sauce arachide</div>
                <div class="food-description">Riz sauce arachide</div>
                <div class="food-price">800 FCFA</div>
                <button class="add-to-cart-btn" onclick="promptAddToCart('Riz sauce Arachide', 800, 'C')">
                    üõí Ajouter au panier
                </button>
            </div>
        </div>
        
        <div class="food-item">
            <img src="image/riz souce feuille.jpg" alt="Riz sauce feuille" class="food-item-image">
            <div class="food-item-content">
                <div class="food-title">Riz sauce feuille</div>
                <div class="food-description">Riz accompagn√© de sauce aux feuilles vertes riches en vitamines</div>
                <div class="food-price">800 FCFA</div>
                <button class="add-to-cart-btn" onclick="promptAddToCart('Riz sauce feuille', 800, 'C')">
                    üõí Ajouter au panier
                </button>
            </div>
        </div>

        <div class="food-item">
            <img src="image/riz  arachide.jpg" alt="Riz sauce tomate" class="food-item-image">
            <div class="food-item-content">
                <div class="food-title">Riz sauce tomate</div>
                <div class="food-description">Riz sauce tomate</div>
                <div class="food-price">800 FCFA</div>
                <button class="add-to-cart-btn" onclick="promptAddToCart('Riz sauce tomate', 800, 'C')">
                    üõí Ajouter au panier
                </button>
            </div>
        </div>

        <div class="food-item">
            <img src="image/riz auberg.jpg" alt="Riz sauce aubergine" class="food-item-image">
            <div class="food-item-content">
                <div class="food-title">Riz sauce aubergine</div>
                <div class="food-description">Riz sauce aubergine</div>
                <div class="food-price">800 FCFA</div>
                <button class="add-to-cart-btn" onclick="promptAddToCart('Riz sauce aubergine', 800, 'C')">
                    üõí Ajouter au panier
                </button>
            </div>
        </div>
    </div>
    
    <div class="post-actions">
        <div class="action-buttons">
            <button class="action-btn" onclick="likePost(this, 'riz-post')">‚ù§Ô∏è</button>
            <button class="action-btn" onclick="commentPost('riz-post')">üí¨</button>
            <button class="action-btn">üì§</button>
        </div>
        <p style="font-size: 0.875rem; color: var(--on-surface-light); margin: 0;" id="riz-post-likes">
            <strong><span class="like-count">GROUPE EXPRESS</span> personnes</strong> aiment ces plats
        </p>
    </div>
</div>

<!-- Cat√©gorie D - Sp√©cialit√© Porc -->
<div class="post-card">
    <div class="post-header">
        <div class="post-category">
            <div class="category-avatar">üê∑</div>
            <div class="category-info">
                <h3>Porc au four</h3>
            </div>
        </div>
    </div>
    
    <div class="food-grid">
        <div class="food-item">
            <img src="image/porc au .jpg" alt="Porc au four + Atti√©k√®" class="food-item-image">
            <div class="food-item-content">
                <div class="food-title">Porc au four</div>
                <div class="food-description">Porc au four accompagn√© d'atti√©k√®</div>
                <div class="food-price">1000 FCFA</div>
                <button class="add-to-cart-btn" onclick="promptAddToCart('Porc au four accompagn√© datti√©k√®', 1000, 'D')">
                    üõí Ajouter au panier
                </button>
            </div>
        </div>
    </div>
    
    <div class="post-actions">
        <div class="action-buttons">
            <button class="action-btn" onclick="likePost(this, 'porc-post')">‚ù§Ô∏è</button>
            <button class="action-btn" onclick="commentPost('porc-post')">üí¨</button>
            <button class="action-btn">üì§</button>
        </div>
        <p style="font-size: 0.875rem; color: var(--on-surface-light); margin: 0;" id="porc-post-likes">
            <strong><span class="like-count">GROUPE EXPRESS</span> personnes</strong> aiment ce plat
        </p>
    </div>
</div>

<!-- Cat√©gorie E - Atti√©k√® -->
<div class="post-card">
    <div class="post-header">
        <div class="post-category">
            <div class="category-avatar">üåæ</div>
            <div class="category-info">
                <h3>Atti√©k√® sp√©cialit√©</h3>
                <p>D√©couvrez nos plats d'atti√©k√® bien r√©ussi</p>
            </div>
        </div>
    </div>
    
    <div class="food-grid">
        <div class="food-item">
            <img src="image/dindon.jpg" alt="Atti√©k√® dindon" class="food-item-image">
            <div class="food-item-content">
                <div class="food-title">Atti√©k√® dindon</div>
                <div class="food-description">Atti√©k√® servi avec du dindon</div>
                <div class="food-price">1000 FCFA</div>
                <button class="add-to-cart-btn" onclick="promptAddToCart('Atti√©k√® dindon', 1000, 'E')">
                    üõí Ajouter au panier
                </button>
            </div>
        </div>
        
        <div class="food-item">
            <img src="image/atieke poulet.jpg" alt="Atti√©k√® poulet" class="food-item-image">
            <div class="food-item-content">
                <div class="food-title">Atti√©k√® poulet</div>
                <div class="food-description">Atti√©k√® servi avec du poulet</div>
                <div class="food-price">1000 FCFA</div>
                <button class="add-to-cart-btn" onclick="promptAddToCart('Atti√©k√® poulet', 1000, 'E')">
                    üõí Ajouter au panier
                </button>
            </div>
        </div>

        <div class="food-item">
            <img src="image/atieke alloko.jpg" alt="Atti√©k√® poisson" class="food-item-image">
            <div class="food-item-content">
                <div class="food-title">Atti√©k√® poisson</div>
                <div class="food-description">Atti√©k√® servi avec du poisson</div>
                <div class="food-price">1000 FCFA</div>
                <button class="add-to-cart-btn" onclick="promptAddToCart('Atti√©k√® poisson', 1000, 'E')">
                    üõí Ajouter au panier
                </button>
            </div>
        </div>
        
        <div class="food-item">
            <img src="image/garba.jpg" alt="Sp√©cialit√© Garba" class="food-item-image">
            <div class="food-item-content">
                <div class="food-title">Sp√©cialit√© Garba</div>
                <div class="food-description">GARBA</div>
                <div class="food-price">500 FCFA</div>
                <button class="add-to-cart-btn" onclick="promptAddToCart('GARBA', 500, 'E')">
                    üõí Ajouter au panier
                </button>
            </div>
        </div>
    </div>
    
    <div class="post-actions">
        <div class="action-buttons">
            <button class="action-btn" onclick="likePost(this, 'attieke-post')">‚ù§Ô∏è</button>
            <button class="action-btn" onclick="commentPost('attieke-post')">üí¨</button>
            <button class="action-btn">üì§</button>
        </div>
        <p style="font-size: 0.875rem; color: var(--on-surface-light); margin: 0;" id="attieke-post-likes">
            <strong><span class="like-count">GROUPE EXPRESS</span> personnes</strong> aiment ces plats
        </p>
    </div>
</div>

<!-- Cat√©gorie F - Desserts -->
<div class="post-card">
    <div class="post-header">
        <div class="post-category">
            <div class="category-avatar">üç∞</div>
            <div class="category-info">
                <h3>Desserts</h3>
                <p>Pour finir en douceur</p>
            </div>
        </div>
    </div>
    
    <div class="food-grid">
        <div class="food-item">
            <img src="image/deguer.jpg" alt="degu√® raisin" class="food-item-image">
            <div class="food-item-content">
                <div class="food-title">D√™gu√™ raisin</div>
                <div class="food-description">D√™gu√™ raisin - Diff√©rents formats disponibles</div>
                <div class="food-price">√Ä partir de 250 FCFA</div>
                <button class="add-to-cart-btn" onclick="selectDegue('raisin')">
                    üìã S√©lectionner le format
                </button>
            </div>
        </div>
        
        <div class="food-item">
            <img src="image/deguer.jpg" alt="degu√® coco" class="food-item-image">
            <div class="food-item-content">
                <div class="food-title">D√™gu√™ coco</div>
                <div class="food-description">D√™gu√™ coco - Diff√©rents formats disponibles</div>
                <div class="food-price">√Ä partir de 300 FCFA</div>
                <button class="add-to-cart-btn" onclick="selectDegue('coco')">
                    üìã S√©lectionner le format
                </button>
            </div>
        </div>
        
        <div class="food-item">
            <img src="image/deguer.jpg" alt="degu√® simple" class="food-item-image">
            <div class="food-item-content">
                <div class="food-title">D√™gu√™ simple</div>
                <div class="food-description">D√™gu√™ simple - Diff√©rents formats disponibles</div>
                <div class="food-price">√Ä partir de 200 FCFA</div>
                <button class="add-to-cart-btn" onclick="selectDegue('simple')">
                    üìã S√©lectionner le format
                </button>
            </div>
        </div>
        
        <div class="food-item">
            <img src="image/deguer.jpg" alt="degu√® raisin coco" class="food-item-image">
            <div class="food-item-content">
                <div class="food-title">D√™gu√™ raisin coco</div>
                <div class="food-description">D√™gu√™ raisin coco - Diff√©rents formats disponibles</div>
                <div class="food-price">√Ä partir de 400 FCFA</div>
                <button class="add-to-cart-btn" onclick="selectDegue('raisin-coco')">
                    üìã S√©lectionner le format
                </button>
            </div>
        </div>
    </div>
    <div class="post-actions">
        <div class="action-buttons">
            <button class="action-btn" onclick="likePost(this, 'desserts-post')">‚ù§Ô∏è</button>
            <button class="action-btn" onclick="commentPost('desserts-post')">üí¨</button>
            <button class="action-btn">üì§</button>
        </div>
        <p style="font-size: 0.875rem; color: var(--on-surface-light); margin: 0;" id="desserts-post-likes">
            <strong><span class="like-count">GROUPE EXPRESS</span> personnes</strong> aiment ces desserts
        </p>
    </div>
</div>
        </div>
    </div>

    <script type="module">
        // Firebase Configuration
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
        import { getDatabase, ref, push, set, get, onValue } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-database.js";

       const firebaseConfig = {
  apiKey: "AIzaSyBsGrY-AqYMoI70kT3WMxLgW0HwYA4KyaQ",
  authDomain: "livraison-c8498.firebaseapp.com",
  projectId: "livraison-c8498",
  storageBucket: "livraison-c8498.firebasestorage.app",
  messagingSenderId: "403240604780",
  appId: "1:403240604780:web:77d84ad03d68bdaddfb449",
  measurementId: "G-5YF89BZ5RY"
};
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Synchroniser les likes avec Firebase
        window.syncLikes = function() {
            const likesRef = ref(db, 'likes');
            onValue(likesRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    Object.keys(data).forEach(postId => {
                        const likeCountElement = document.querySelector(`#${postId}-likes .like-count`);
                        if (likeCountElement) {
                            likeCountElement.textContent = data[postId].count || 0;
                        }
                    });
                }
            });
        };

        // Fonction pour liker un post
        window.likePost = function(button, postId) {
            if (!window.userProfile) {
                alert("Veuillez cr√©er votre profil pour liker !");
                window.openProfile();
                return;
            }

            const likesRef = ref(db, `likes/${postId}`);
            get(likesRef).then((snapshot) => {
                const currentData = snapshot.val() || { count: 0, users: {} };
                const userId = window.userProfile.email;
                
                if (currentData.users && currentData.users[userId]) {
                    // Retirer le like
                    delete currentData.users[userId];
                    currentData.count = Math.max(0, currentData.count - 1);
                    button.classList.remove('liked');
                } else {
                    // Ajouter le like
                    if (!currentData.users) currentData.users = {};
                    currentData.users[userId] = true;
                    currentData.count = (currentData.count || 0) + 1;
                    button.classList.add('liked');
                }
                
                set(likesRef, currentData);
            });
        };

        // Fonction pour commenter
        window.commentPost = function(postId) {
            if (!window.userProfile) {
                alert("Veuillez cr√©er votre profil pour commenter !");
                window.openProfile();
                return;
            }
            
            const comment = prompt("Votre commentaire :");
            if (comment && comment.trim()) {
                const commentsRef = ref(db, `comments/${postId}`);
                push(commentsRef, {
                    text: comment.trim(),
                    author: `${window.userProfile.firstname} ${window.userProfile.lastname}`,
                    timestamp: new Date().toISOString()
                });
                alert("Commentaire ajout√© !");
            }
        };

        // Fonction d'envoi de commande avec code unique
        window.submitOrder = function(order) {
            const orderRef = ref(db, 'orders');
            const newOrderRef = push(orderRef);
            
            // G√©n√©rer un code unique bas√© sur timestamp et cat√©gorie
            const timestamp = Date.now();
            const mainCategory = order.items.length > 0 ? order.items[0].category : 'A';
            const uniqueCode = `#LE${mainCategory}${timestamp.toString().slice(-6)}`;
            
            order.code = uniqueCode;
            order.timestamp = new Date().toISOString();
            order.status = "nouveau";
            
            return set(newOrderRef, order)
                .then(() => {
                    console.log('Commande envoy√©e avec succ√®s');
                    return uniqueCode;
                })
                .catch((error) => {
                    console.error('Erreur Firebase:', error);
                    return false;
                });
        };

        // Initialiser la synchronisation des likes au chargement
        window.addEventListener('DOMContentLoaded', () => {
            window.syncLikes();
        });
    </script>

    <script>
     // Variables globales avec persistance localStorage
let userProfile = JSON.parse(localStorage.getItem('userProfile')) || null;
let cart = [];
let total = 0;
let customerOrders = JSON.parse(localStorage.getItem('customerOrders')) || [];
        // V√©rification des heures de commande avec fuseau horaire d'Abidjan
function checkOrderingHours() {
    const now = new Date();
    const abidjanTime = new Date(now.toLocaleString("en-US", {timeZone: "Africa/Abidjan"}));
    const hour = abidjanTime.getHours();
    const minute = abidjanTime.getMinutes();
    const isOrderingClosed = hour >= 10 && hour < 18;
    
    const timeAlert = document.getElementById('time-alert');
    const addToCartButtons = document.querySelectorAll('.add-to-cart-btn');
    const checkoutButton = document.querySelector('.checkout-btn');
    
    // Calcul du temps restant jusqu'√† la r√©ouverture
    let timeUntilOpen = '';
    if (isOrderingClosed) {
        const reopenTime = new Date(abidjanTime);
        reopenTime.setHours(18, 0, 0, 0);
        if (reopenTime <= abidjanTime) {
            reopenTime.setDate(reopenTime.getDate() + 1);
        }
        const diff = reopenTime - abidjanTime;
        const hoursLeft = Math.floor(diff / (1000 * 60 * 60));
        const minutesLeft = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        timeUntilOpen = ` (R√©ouverture dans ${hoursLeft}h ${minutesLeft}min)`;
    }
    
    if (isOrderingClosed) {
        timeAlert.innerHTML = `‚è∞ Les commandes sont ferm√©es de 10h00 √† 18h00 (Heure d'Abidjan)${timeUntilOpen}`;
        timeAlert.style.display = 'block';
        addToCartButtons.forEach(btn => {
            btn.disabled = true;
            btn.textContent = '‚è∞ Commandes ferm√©es';
        });
        if (checkoutButton) {
            checkoutButton.disabled = true;
            checkoutButton.textContent = `‚è∞ Commandes ferm√©es${timeUntilOpen}`;
        }
    } else {
        // Calcul du temps restant avant fermeture
        const closeTime = new Date(abidjanTime);
        closeTime.setHours(10, 0, 0, 0);
        if (closeTime <= abidjanTime) {
            closeTime.setDate(closeTime.getDate() + 1);
        }
        const diff = closeTime - abidjanTime;
        const hoursLeft = Math.floor(diff / (1000 * 60 * 60));
        const minutesLeft = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        
        if (hoursLeft < 2) { // Afficher l'alerte si moins de 2h restantes
            timeAlert.innerHTML = `‚ö†Ô∏è Commandes ouvertes - Fermeture dans ${hoursLeft}h ${minutesLeft}min`;
            timeAlert.style.display = 'block';
            timeAlert.style.background = 'linear-gradient(135deg, #28a745, #34ce57)';
        } else {
            timeAlert.style.display = 'none';
        }
        
        addToCartButtons.forEach(btn => {
            btn.disabled = false;
            if (btn.textContent.includes('‚è∞')) {
                btn.innerHTML = 'üõí Ajouter au panier';
            }
        });
        if (checkoutButton) {
            checkoutButton.disabled = false;
            checkoutButton.textContent = 'üéØ Commander maintenant';
        }
    }
}

        // Gestion du panier
        function toggleCart() {
            if (!userProfile) {
                alert("Veuillez cr√©er votre profil d'abord pour acc√©der au panier !");
                openProfile();
                return;
            }
            const modal = document.getElementById('cart-modal');
            modal.classList.toggle('show');
        }

        function updateCartBadge() {
            const badge = document.getElementById('cart-badge');
            const totalItems = cart.reduce((sum, item) => sum + item.qty, 0);
            
            if (totalItems > 0) {
                badge.textContent = totalItems;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }

        // Configuration des d√™gu√™s
const degueTypes = {
    'raisin': {
        name: 'D√™gu√™ raisin',
        prices: {
            'Sachet': 250,
            'Petit bidon': 500,
            'Moyen bidon': 1500,
            'Grand bidon': 3000
        }
    },
    'coco': {
        name: 'D√™gu√™ coco',
        prices: {
            'Sachet': 300,
            'Petit bidon': 600,
            'Moyen bidon': 1600,
            'Grand bidon': 3500
        }
    },
    'simple': {
        name: 'D√™gu√™ simple',
        prices: {
            'Sachet': 200,
            'Petit bidon': 500,
            'Moyen bidon': 1500,
            'Grand bidon': 3000
        }
    },
    'raisin-coco': {
        name: 'D√™gu√™ raisin coco',
        prices: {
            'Sachet': 400,
            'Petit bidon': 700,
            'Moyen bidon': 1700,
            'Grand bidon': 3600
        }
    }
};

let currentDegueType = '';

// Gestion du D√™gu√™
function selectDegue(type) {
    if (!userProfile) {
        alert("Veuillez cr√©er votre profil d'abord !");
        openProfile();
        return;
    }
    
    currentDegueType = type;
    const degueData = degueTypes[type];
    
    // Mettre √† jour le titre du modal
    document.getElementById('degue-modal-title').textContent = `ü•õ Choisir votre format de ${degueData.name}`;
    
    // G√©n√©rer les options
    const optionsContainer = document.getElementById('degue-options');
    optionsContainer.innerHTML = '';
    
    const formats = [
        { key: 'Sachet', icon: 'üì¶', desc: 'Format individuel' },
        { key: 'Petit bidon', icon: 'ü•§', desc: 'Pour 1-2 personnes' },
        { key: 'Moyen bidon', icon: 'ü™£', desc: 'Pour 3-4 personnes' },
        { key: 'Grand bidon', icon: 'üõ¢Ô∏è', desc: 'Pour 5+ personnes' }
    ];
    
    formats.forEach(format => {
        const price = degueData.prices[format.key];
        const optionDiv = document.createElement('div');
        optionDiv.className = 'degue-option';
        optionDiv.onclick = () => addDegueToCart(format.key, price);
        optionDiv.innerHTML = `
            <div class="degue-option-info">
                <div class="degue-option-icon">${format.icon}</div>
                <div class="degue-option-details">
                    <h4>${format.key}</h4>
                    <p>${format.desc}</p>
                </div>
            </div>
            <div class="degue-option-price">${price} FCFA</div>
        `;
        optionsContainer.appendChild(optionDiv);
    });
    
    const modal = document.getElementById('degue-modal');
    modal.classList.add('show');
}

function addDegueToCart(format, price) {
    const degueData = degueTypes[currentDegueType];
    const qty = prompt(`Quantit√© de ${degueData.name} (${format}) :`, "1");
    const quantity = parseInt(qty, 10);
    if (!isNaN(quantity) && quantity > 0) {
        addToCart(`${degueData.name} (${format})`, price, 'F', quantity);
        closeDegueModal();
    }
}
        // Gestion du profil utilisateur
        function showTab(tabId) {
            document.querySelectorAll('.modal-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            document.querySelectorAll('.modal-tab').forEach(tab => {
                if (tab.getAttribute('onclick').includes(tabId)) {
                    tab.classList.add('active');
                }
            });
            document.getElementById(tabId).classList.add('active');
        }

        function openProfile() {
            const modal = document.getElementById('profile-modal');
            modal.classList.add('show');
            
            if (userProfile) {
                document.getElementById('profile-lastname').value = userProfile.lastname || '';
                document.getElementById('profile-firstname').value = userProfile.firstname || '';
                document.getElementById('profile-email').value = userProfile.email || '';
                
                if (userProfile.photo) {
                    const preview = document.getElementById('profile-photo-preview');
                    preview.src = userProfile.photo;
                    preview.style.display = 'block';
                }
            }
        }

        function closeProfile() {
            if (userProfile) {
                document.getElementById('profile-modal').classList.remove('show');
            }
        }

        function applyUserProfile() {
            if (userProfile) {
                const userProfileEl = document.getElementById('user-profile');
                const userAvatar = document.getElementById('user-avatar');
                const userName = document.getElementById('user-name');
                
                userProfileEl.style.display = 'flex';
                userName.textContent = `${userProfile.firstname} ${userProfile.lastname}`;
                
                if (userProfile.photo) {
                    userAvatar.src = userProfile.photo;
                } else {
                    userAvatar.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(userProfile.firstname + '+' + userProfile.lastname)}&background=E1306C&color=fff&size=32`;
                }
            }
        }

        // Gestion du panier
        function promptAddToCart(name, price, category) {
            if (!userProfile) {
                alert("Veuillez cr√©er votre profil d'abord !");
                openProfile();
                return;
            }
            
  const now = new Date();
const abidjanTime = new Date(now.toLocaleString("en-US", {timeZone: "Africa/Abidjan"}));
const hour = abidjanTime.getHours();
if (hour >= 10 && hour < 18) {
    alert("Les commandes sont ferm√©es de 10h √† 18h (heure d'Abidjan) !");
    return;
}
            
            const qty = prompt("Choisir la quantit√© :", "1");
            const quantity = parseInt(qty, 10);
            if (!isNaN(quantity) && quantity > 0) {
                addToCart(name, price, category, quantity);
            }
        }

        function addToCart(name, price, category, qty = 1) {
            cart.push({ name, price, category, qty });
            updateCart();
            updateCartBadge();
            
            // Animation d'ajout
            const notification = document.createElement('div');
            notification.innerHTML = `‚úÖ ${qty} ${name} ajout√©(s) au panier!`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--gradient);
                color: white;
                padding: 1rem 2rem;
                border-radius: 50px;
                z-index: 1001;
                animation: slideInRight 0.3s ease-out;
                font-weight: 600;
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function updateCart() {
            const cartItems = document.getElementById('cart-items');
            const cartTotal = document.getElementById('cart-total');
            
            cartItems.innerHTML = '';
            total = 0;
            
            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üõí</div>
                        <p>Votre panier est vide</p>
                    </div>
                `;
            } else {
                cart.forEach((item, index) => {
                    const cartItem = document.createElement('div');
                    cartItem.className = 'cart-item';
                    cartItem.innerHTML = `
                        <img src="https://ui-avatars.com/api/?name=${encodeURIComponent(item.name)}&background=E1306C&color=fff&size=40" class="cart-item-image" alt="${item.name}">
                        <div class="cart-item-info">
                            <div class="cart-item-name">${item.qty}x ${item.name}</div>
                            <div class="cart-item-price">${item.price * item.qty} FCFA</div>
                        </div>
                        <button class="remove-btn" onclick="removeFromCart(${index})">√ó</button>
                    `;
                    cartItems.appendChild(cartItem);
                    total += item.price * item.qty;
                });
            }
            cartTotal.textContent = `Total: ${total.toLocaleString()} FCFA`;
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCart();
            updateCartBadge();
        }

        function addCustomerOrderToList(orderCode, order) {
    const summary = order.items.map(i => `${i.qty}x ${i.name}`).join(', ');
    const entry = {
        code: orderCode,
        summary,
        total: order.total,
        date: new Date().toLocaleString()
    };
    customerOrders.push(entry);
    localStorage.setItem('customerOrders', JSON.stringify(customerOrders));
    updateOrdersList();
}

        function updateOrdersList() {
            const ordersList = document.getElementById('orders-list');
            ordersList.innerHTML = '';
            
            if (customerOrders.length === 0) {
                ordersList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üõí</div>
                        <h3>Aucune commande</h3>
                        <p>Vos commandes appara√Ætront ici</p>
                    </div>
                `;
            } else {
                customerOrders.slice().reverse().forEach(entry => {
                    const orderDiv = document.createElement('div');
                    orderDiv.className = 'order-item-history';
                    orderDiv.style.cssText = `
                        background: var(--surface);
                        border: 1px solid var(--border);
                        border-radius: 12px;
                        padding: 1rem;
                        margin-bottom: 1rem;
                    `;
                    orderDiv.innerHTML = `
                        <div style="font-weight: 600; color: var(--primary); margin-bottom: 0.5rem;">${entry.code}</div>
                        <div style="font-size: 0.875rem; margin-bottom: 0.5rem;">${entry.summary}</div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 600; color: var(--primary);">${entry.total} FCFA</span>
                            <span style="font-size: 0.75rem; color: var(--on-surface-light);">${entry.date}</span>
                        </div>
                    `;
                    ordersList.appendChild(orderDiv);
                });
            }
        }

        function toggleOrders() {
            if (!userProfile) {
                alert("Veuillez cr√©er votre profil d'abord !");
                openProfile();
                return;
            }
            const modal = document.getElementById('orders-modal');
            modal.classList.toggle('show');
            updateOrdersList();
        }

       function clearOrders() {
    if (confirm("Vider l'historique des commandes ?")) {
        customerOrders = [];
        localStorage.removeItem('customerOrders');
        updateOrdersList();
    }
}
        // Fonctions utilitaires
        function showAbout() {
            alert("üçΩÔ∏è LOKO EXPRESS\n\nVotre service de livraison de repas universitaires pr√©f√©r√© !\n\nNous proposons des plats d√©licieux, frais et abordables directement sur votre campus.\n\nHeures de commande : 18h00 - 10h00");
        }

        // Gestion des √©v√©nements
        document.addEventListener('DOMContentLoaded', function() {
            // V√©rifier les heures de commande
            checkOrderingHours();
            setInterval(checkOrderingHours, 60000); // V√©rifier chaque minute
            
          // V√©rifier si un profil existe
if (!userProfile) {
    openProfile();
} else {
    applyUserProfile();
}

// Charger les commandes sauvegard√©es
updateOrdersList();
            // Configuration du formulaire de profil
            document.getElementById('profile-photo').addEventListener('change', function() {
                const file = this.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const preview = document.getElementById('profile-photo-preview');
                        preview.src = e.target.result;
                        preview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            });

            document.getElementById('profile-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const photoPreview = document.getElementById('profile-photo-preview');
   userProfile = {
    lastname: document.getElementById('profile-lastname').value,
    firstname: document.getElementById('profile-firstname').value,
    email: document.getElementById('profile-email').value,
    photo: photoPreview.style.display === 'block' ? photoPreview.src : null
};

// Sauvegarder dans localStorage
localStorage.setItem('userProfile', JSON.stringify(userProfile));
window.userProfile = userProfile;
                
                // Animation de succ√®s
                const success = document.createElement('div');
                success.innerHTML = 'üéâ Profil cr√©√© avec succ√®s !';
                success.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: var(--gradient);
                    color: white;
                    padding: 2rem 3rem;
                    border-radius: 20px;
                    z-index: 1002;
                    font-size: 1.2rem;
                    font-weight: 600;
                    text-align: center;
                `;
                document.body.appendChild(success);
                
                setTimeout(() => {
                    success.remove();
                }, 2000);
            });

            // Configuration du formulaire de commande
            document.getElementById('order-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (cart.length === 0) {
                    alert("Votre panier est vide !");
                    return;
                }
                
                if (!userProfile) {
                    alert("Veuillez cr√©er votre profil d'abord !");
                    openProfile();
                    return;
                }
                
                const now = new Date();
const abidjanTime = new Date(now.toLocaleString("en-US", {timeZone: "Africa/Abidjan"}));
const hour = abidjanTime.getHours();
if (hour >= 10 && hour < 18) {
    alert("Les commandes sont ferm√©es de 10h √† 18h (heure d'Abidjan) !");
    return;
}
                
                const order = {
                    customer: { ...userProfile },
                    items: [...cart],
                    total
                };
                
                // Envoi de la commande
                window.submitOrder(order).then(orderCode => {
                    if (orderCode) {
                        addCustomerOrderToList(orderCode, order);
                        cart = [];
                        updateCart();
                        updateCartBadge();
                        toggleCart();
                        
                        // Message de retrait
                        const pickupMessage = document.createElement('div');
                        pickupMessage.innerHTML = `
                            <div style="text-align: center; margin-bottom: 1rem;">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">üéâ</div>
                                <h3>Commande ${orderCode} envoy√©e !</h3>
                            </div>
                            <div style="background: linear-gradient(135deg, #28a745, #34ce57); color: white; padding: 1.5rem; border-radius: 12px; text-align: center; margin-bottom: 1rem;">
                                <strong>üìç RETRAIT DE VOTRE COMMANDE</strong><br>
                                Veuillez passer en bas au rez-de-chauss√©e<br>
                                Un livreur vous contactera bient√¥t
                            </div>
                            <div style="text-align: center; font-size: 0.875rem; color: var(--on-surface-light);">
                                Merci de votre confiance ! üôè
                            </div>
                        `;
                        pickupMessage.style.cssText = `
                            position: fixed;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            background: var(--surface);
                            padding: 2rem;
                            border-radius: 20px;
                            z-index: 1002;
                            max-width: 350px;
                            box-shadow: var(--shadow-lg);
                            border: 2px solid var(--primary);
                        `;
                        document.body.appendChild(pickupMessage);
                        
                        setTimeout(() => {
                            pickupMessage.remove();
                        }, 8000);
                    } else {
                        alert("Erreur lors de l'envoi. Veuillez r√©essayer.");
                    }
                });
            });
        });

        // Fermeture des modals en cliquant √† l'ext√©rieur
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal') || e.target.classList.contains('cart-modal') || e.target.classList.contains('degue-modal')) {
                e.target.classList.remove('show');
            }
        });

        // Exposition des fonctions globales
        window.userProfile = userProfile;
        window.openProfile = openProfile;
        window.closeProfile = closeProfile;
        window.showTab = showTab;
        window.promptAddToCart = promptAddToCart;
        window.removeFromCart = removeFromCart;
        window.toggleOrders = toggleOrders;
        window.clearOrders = clearOrders;
        window.showAbout = showAbout;
        window.toggleCart = toggleCart;
        window.selectDegue = selectDegue;
        window.closeDegueModal = closeDegueModal;
        window.addDegueToCart = addDegueToCart;

        // Fonction pour afficher les commentaires
window.showComments = function(postId) {
    const commentsRef = ref(db, `comments/${postId}`);
    get(commentsRef).then((snapshot) => {
        const comments = snapshot.val();
        if (comments) {
            let commentsList = "üí¨ Commentaires r√©cents :\n\n";
            Object.values(comments).slice(-5).forEach(comment => {
                commentsList += `üë§ ${comment.author}: ${comment.text}\n`;
            });
            alert(commentsList);
        } else {
            alert("Aucun commentaire pour ce plat");
        }
    });
};
// Variables pour le paiement Wave
let currentOrderData = null;
let currentPaymentStep = 1;
let selectedPaymentMethod = 'cash'; // Par d√©faut

// Exposer les fonctions globalement au chargement
document.addEventListener('DOMContentLoaded', function() {
    // V√©rifier les heures de commande
    checkOrderingHours();
    setInterval(checkOrderingHours, 60000);
    
    // Rendre les fonctions globalement accessibles
    window.selectPaymentMethod = selectPaymentMethod;
    window.nextStep = nextStep;
    window.closePaymentModal = closePaymentModal;
    window.copyWaveNumber = copyWaveNumber;
    window.confirmWaveOrder = confirmWaveOrder;
    window.verifyPayment = verifyPayment;
    window.contactSupport = contactSupport;
        window.updateWaveNumberInModal = updateWaveNumberInModal;
    
    // V√©rifier si un profil existe
    if (!userProfile) {
        openProfile();
    } else {
        applyUserProfile();
    }

    // Charger les commandes sauvegard√©es
    updateOrdersList();
    
    // Initialiser les gestionnaires d'upload
    initializeImageUpload();
    
    // Mettre √† jour le num√©ro Wave dans le modal
    updateWaveNumberInModal();
    
    // Configuration du formulaire de profil
    document.getElementById('profile-photo').addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('profile-photo-preview');
                preview.src = e.target.result;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
    });

    document.getElementById('profile-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const photoPreview = document.getElementById('profile-photo-preview');
        userProfile = {
            lastname: document.getElementById('profile-lastname').value,
            firstname: document.getElementById('profile-firstname').value,
            email: document.getElementById('profile-email').value,
            photo: photoPreview.style.display === 'block' ? photoPreview.src : null
        };

        // Sauvegarder dans localStorage
        localStorage.setItem('userProfile', JSON.stringify(userProfile));
        window.userProfile = userProfile;
        applyUserProfile();
        closeProfile();
        
        // Animation de succ√®s
        const success = document.createElement('div');
        success.innerHTML = 'Profil cr√©√© avec succ√®s !';
        success.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--gradient);
            color: white;
            padding: 2rem 3rem;
            border-radius: 20px;
            z-index: 1002;
            font-size: 1.2rem;
            font-weight: 600;
            text-align: center;
        `;
        document.body.appendChild(success);
        
        setTimeout(() => {
            success.remove();
        }, 2000);
    });

    // Configuration du formulaire de commande modifi√©
    document.getElementById('order-form').addEventListener('submit', handleOrderSubmission);

});

// Fonction de s√©lection corrig√©e
function selectPaymentMethod(method) {
    selectedPaymentMethod = method;
    console.log('Mode de paiement s√©lectionn√©:', method);
    
    // Mettre √† jour l'interface
    document.querySelectorAll('.payment-method').forEach(el => {
        el.classList.remove('selected');
    });
    
    const selectedElement = document.getElementById(`${method}-method`);
    if (selectedElement) {
        selectedElement.classList.add('selected');
    }
    
    updateCheckoutButton();
}
    
    // Ajouter la s√©lection du mode de paiement AVANT le bouton de checkout
    const checkoutBtn = orderForm.querySelector('.checkout-btn');
    
    const paymentSelection = document.createElement('div');
    paymentSelection.className = 'payment-method-selection';
    paymentSelection.innerHTML = `
        <h4 style="margin-bottom: 1rem;">Choisissez votre mode de paiement :</h4>
        
        <div class="payment-method selected" onclick="selectPaymentMethod('cash')" id="cash-method">
            <div class="payment-method-icon">üí∞</div>
            <div class="payment-method-info">
                <h4>Paiement √† la livraison</h4>
                <p>Payez en esp√®ces lors de la r√©ception</p>
            </div>
        </div>
        
        <div class="payment-method" onclick="selectPaymentMethod('wave')" id="wave-method">
            <div class="payment-method-icon">W</div>
            <div class="payment-method-info">
                <h4>Paiement Wave</h4>
                <p>Paiement mobile s√©curis√© avec v√©rification automatique</p>
            </div>
        </div>
    `;
    
    orderForm.insertBefore(paymentSelection, checkoutBtn);
    
    // Modifier le texte du bouton en fonction du mode de paiement
    updateCheckoutButton();


// S√©lection du mode de paiement
function selectPaymentMethod(method) {
    selectedPaymentMethod = method;
    
    // Mettre √† jour l'interface
    document.querySelectorAll('.payment-method').forEach(el => {
        el.classList.remove('selected');
    });
    document.getElementById(`${method}-method`).classList.add('selected');
    
    updateCheckoutButton();
}

function updateCheckoutButton() {
    const checkoutBtn = document.querySelector('.checkout-btn');
    if (selectedPaymentMethod === 'wave') {
        checkoutBtn.textContent = 'üí≥ Payer avec Wave';
    } else {
        checkoutBtn.textContent = 'üéØ Commander (paiement √† la livraison)';
    }
}

// Modifier la fonction de soumission de commande existante
function modifyOrderSubmission() {
    const orderForm = document.getElementById('order-form');
    
    // Remplacer l'ancien gestionnaire d'√©v√©nement
    orderForm.removeEventListener('submit', originalSubmitHandler);
    orderForm.addEventListener('submit', newSubmitHandler);
}

function newSubmitHandler(e) {
    e.preventDefault();
    
    if (cart.length === 0) {
        alert("Votre panier est vide !");
        return;
    }
    
    if (!userProfile) {
        alert("Veuillez cr√©er votre profil d'abord !");
        openProfile();
        return;
    }
    
    // V√©rifier les heures d'ouverture
    const now = new Date();
    const abidjanTime = new Date(now.toLocaleString("en-US", {timeZone: "Africa/Abidjan"}));
    const hour = abidjanTime.getHours();
    if (hour >= 10 && hour < 18) {
        alert("Les commandes sont ferm√©es de 10h √† 18h (heure d'Abidjan) !");
        return;
    }
    
    // Pr√©parer les donn√©es de commande
    currentOrderData = {
        customer: { ...userProfile },
        items: [...cart],
        total,
        paymentMethod: selectedPaymentMethod
    };
    
    if (selectedPaymentMethod === 'wave') {
        // Ouvrir le modal de paiement Wave
        openWavePaymentModal(currentOrderData);
    } else {
        // Traitement normal pour paiement √† la livraison
        processNormalOrder(currentOrderData);
    }
}

// Ouvrir le modal de paiement Wave
function openWavePaymentModal(orderData) {
    const orderCode = generateOrderCode();
    const itemsText = orderData.items.map(item => `${item.qty}x ${item.name}`).join(', ');
    
    // Remplir les informations de commande
    document.getElementById('order-code-payment').textContent = orderCode;
    document.getElementById('order-items-payment').textContent = itemsText;
    document.getElementById('order-total-payment').textContent = orderData.total + ' FCFA';
    
    // Ouvrir le modal
    document.getElementById('payment-modal').classList.add('show');
    currentPaymentStep = 1;
    showPaymentStep(1);
    
    // Fermer le panier
    toggleCart();
}

// Traitement de commande normale (paiement √† la livraison)
function processNormalOrder(orderData) {
    window.submitOrder(orderData).then(orderCode => {
        if (orderCode) {
            addCustomerOrderToList(orderCode, orderData);
            cart = [];
            updateCart();
            updateCartBadge();
            toggleCart();
            
            showOrderConfirmation(orderCode, 'cash');
        } else {
            alert("Erreur lors de l'envoi. Veuillez r√©essayer.");
        }
    });
}

// G√©n√©rer un code de commande unique
function generateOrderCode() {
    const timestamp = Date.now();
    const mainCategory = currentOrderData.items.length > 0 ? currentOrderData.items[0].category : 'A';
    return `#LE${mainCategory}${timestamp.toString().slice(-6)}`;
}

// Afficher la confirmation de commande
function showOrderConfirmation(orderCode, paymentMethod) {
    const paymentText = paymentMethod === 'wave' ? 
        'Paiement Wave valid√©' : 
        'Paiement √† la livraison';
    
    const pickupMessage = document.createElement('div');
    pickupMessage.innerHTML = `
        <div style="text-align: center; margin-bottom: 1rem;">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üéâ</div>
            <h3>Commande ${orderCode} confirm√©e !</h3>
        </div>
        <div style="background: linear-gradient(135deg, #28a745, #34ce57); color: white; padding: 1.5rem; border-radius: 12px; text-align: center; margin-bottom: 1rem;">
            <strong>üìç RETRAIT DE VOTRE COMMANDE</strong><br>
            ${paymentText}<br>
            Veuillez passer en bas au rez-de-chauss√©e<br>
            Un livreur vous contactera bient√¥t
        </div>
        <div style="text-align: center; font-size: 0.875rem; color: var(--on-surface-light);">
            Merci de votre confiance ! üôè
        </div>
    `;
    pickupMessage.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: var(--surface);
        padding: 2rem;
        border-radius: 20px;
        z-index: 1002;
        max-width: 350px;
        box-shadow: var(--shadow-lg);
        border: 2px solid var(--primary);
    `;
    document.body.appendChild(pickupMessage);
    
    setTimeout(() => {
        pickupMessage.remove();
    }, 8000);
}

// Fonctions de navigation Wave
function nextStep(step) {
    currentPaymentStep = step;
    showPaymentStep(step);
}

function showPaymentStep(step) {
    document.querySelectorAll('.payment-step').forEach(el => {
        el.classList.remove('active');
    });
    document.getElementById(`step-${step}`).classList.add('active');
}

function closePaymentModal() {
    document.getElementById('payment-modal').classList.remove('show');
    resetPaymentProcess();
}

function resetPaymentProcess() {
    currentPaymentStep = 1;
    // R√©initialiser les autres √©l√©ments du processus de paiement
}

function copyWaveNumber() {
    const waveNumber = "+225 01 72 36 98 40";
    navigator.clipboard.writeText(waveNumber).then(() => {
        alert('üìã Num√©ro Wave copi√© !');
    }).catch(() => {
        // Fallback si clipboard ne fonctionne pas
        prompt("Copiez ce num√©ro:", waveNumber);
    });
}

// Mettre √† jour aussi dans le HTML
function updateWaveNumberInModal() {
    document.getElementById('wave-number').innerHTML = `
        üì± +225 01 72 36 98 40
        <button class="copy-btn" onclick="copyWaveNumber()" style="margin-left: 1rem; padding: 0.5rem 1rem;">
            üìã Copier
        </button>
        <br><br>
        <a href="https://wave.com/send?phone=22501723698440" target="_blank" 
           style="background: linear-gradient(135deg, #0066CC, #FF6B00); color: white; padding: 1rem 2rem; text-decoration: none; border-radius: 12px; display: inline-block; font-weight: 600; margin-top: 1rem;">
            üîó Ouvrir Wave directement
        </a>
    `;
}
// Confirmation finale de commande Wave
function confirmWaveOrder() {
    if (currentOrderData) {
        // Marquer comme pay√© via Wave
        currentOrderData.paymentStatus = 'paid_wave';
        currentOrderData.paymentVerified = true;
        
        window.submitOrder(currentOrderData).then(orderCode => {
            if (orderCode) {
                addCustomerOrderToList(orderCode, currentOrderData);
                cart = [];
                updateCart();
                updateCartBadge();
                closePaymentModal();
                
                showOrderConfirmation(orderCode, 'wave');
                currentOrderData = null;
            } else {
                alert("Erreur lors de la finalisation. Veuillez contacter le support.");
            }
        });
    }
}

// Initialisation au chargement de la page
document.addEventListener('DOMContentLoaded', function() {
    // Modifier le formulaire de checkout apr√®s le chargement
    setTimeout(() => {
        modifyCheckoutForm();
        modifyOrderSubmission();
    }, 1000);
});

// Export des fonctions pour utilisation globale
window.selectPaymentMethod = selectPaymentMethod;
window.openWavePaymentModal = openWavePaymentModal;
window.nextStep = nextStep;
window.closePaymentModal = closePaymentModal;
window.copyWaveNumber = copyWaveNumber;
window.confirmWaveOrder = confirmWaveOrder;

// Syst√®me de v√©rification avanc√©
async function verifyPayment() {
    const screenshotInput = document.getElementById('screenshot-input');
    const verifyBtn = document.getElementById('verify-btn');
    const progressFill = document.getElementById('progress-fill');
    const verificationStatus = document.getElementById('verification-status');
    const verificationDetails = document.getElementById('verification-details');
    
    if (!screenshotInput.files[0]) {
        alert('Veuillez s√©lectionner une capture d\'√©cran');
        return;
    }
    
    verifyBtn.disabled = true;
    verifyBtn.innerHTML = '<div class="spinner"></div> V√©rification...';
    nextStep(3);
    
    try {
        // √âtape 1: Reconnaissance OCR
        progressFill.style.width = '25%';
        verificationStatus.innerHTML = '<div class="spinner"></div> Extraction du texte...';
        
        const { data: { text } } = await Tesseract.recognize(
            screenshotInput.files[0],
            'fra+eng',
            {
                logger: m => {
                    if (m.status === 'recognizing text') {
                        const progress = Math.round(m.progress * 25 + 25);
                        progressFill.style.width = `${progress}%`;
                    }
                }
            }
        );
        
        progressFill.style.width = '50%';
        
        // √âtape 2: Analyse et validation
        verificationStatus.innerHTML = '<div class="spinner"></div> Analyse des donn√©es...';
        
        const analysis = await analyzePaymentScreenshot(text);
        
        progressFill.style.width = '75%';
        
        // √âtape 3: V√©rification anti-fraude
        verificationStatus.innerHTML = '<div class="spinner"></div> V√©rification anti-fraude...';
        
        const fraudCheck = await performFraudDetection(analysis, screenshotInput.files[0]);
        
        progressFill.style.width = '100%';
        
        // Afficher les r√©sultats
        displayVerificationResults(analysis, fraudCheck);
        
    } catch (error) {
        console.error('Erreur de v√©rification:', error);
        verificationStatus.className = 'verification-status error';
        verificationStatus.innerHTML = '‚ùå Erreur lors de la v√©rification. Veuillez r√©essayer.';
        nextStep(4);
        showErrorActions();
    }
}

// Analyse approfondie du texte extrait
async function analyzePaymentScreenshot(text) {
    const expectedAmount = currentOrderData.total;
    const expectedRecipient = "GROUPE EXPRESS";
    const waveNumber = "01723698400";
    
    // Patterns de reconnaissance
    const patterns = {
        transaction: /(?:transaction|ref|reference)[:\s]*([A-Z0-9]{8,})/i,
        amount: /(\d+(?:[,\s]\d{3})*)\s*(?:FCFA|CFA|F)/i,
        recipient: /(?:destinataire|√†|vers|to)[:\s]*(.*?)(?:\n|$)/i,
        datetime: /(\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}[\s,]*\d{1,2}[:h]\d{2})/i,
        phone: /(\d{2,3}[\s\-]?\d{2}[\s\-]?\d{2}[\s\-]?\d{2}[\s\-]?\d{2}[\s\-]?\d{2})/g
    };
    
    const results = {
        transactionId: null,
        amount: null,
        recipient: null,
        datetime: null,
        phoneFound: false,
        validationScore: 0
    };
    
    // Extraction des donn√©es
    const transactionMatch = text.match(patterns.transaction);
    if (transactionMatch) {
        results.transactionId = transactionMatch[1];
        results.validationScore += 20;
    }
    
    const amountMatch = text.match(patterns.amount);
    if (amountMatch) {
        const extractedAmount = parseInt(amountMatch[1].replace(/[,\s]/g, ''));
        results.amount = extractedAmount;
        if (Math.abs(extractedAmount - expectedAmount) <= 10) {
            results.validationScore += 30;
        }
    }
    
    const recipientMatch = text.match(patterns.recipient);
    if (recipientMatch) {
        results.recipient = recipientMatch[1].trim();
        if (results.recipient.toUpperCase().includes(expectedRecipient)) {
            results.validationScore += 25;
        }
    }
    
    const datetimeMatch = text.match(patterns.datetime);
    if (datetimeMatch) {
        results.datetime = datetimeMatch[1];
        // V√©rifier si la date est r√©cente (moins de 30 minutes)
        const now = new Date();
        const transactionTime = parseTransactionTime(results.datetime);
        if (transactionTime && (now - transactionTime) < 30 * 60 * 1000) {
            results.validationScore += 15;
        }
    }
    
    // V√©rification du num√©ro de t√©l√©phone
    const phoneMatches = text.match(patterns.phone);
    if (phoneMatches) {
        phoneMatches.forEach(phone => {
            const cleanPhone = phone.replace(/[\s\-]/g, '');
            if (cleanPhone.includes(waveNumber) || cleanPhone.includes('0172369840')) {
                results.phoneFound = true;
                results.validationScore += 10;
            }
        });
    }
    
    return results;
}

// D√©tection anti-fraude avanc√©e
async function performFraudDetection(analysis, imageFile) {
    const checks = {
        imageQuality: false,
        metadataValid: false,
        duplicateCheck: false,
        timeConsistency: false,
        overallScore: 0
    };
    
    // V√©rification 1: Qualit√© de l'image
    const imageQuality = await checkImageQuality(imageFile);
    checks.imageQuality = imageQuality.score > 0.7;
    
    // V√©rification 2: M√©tadonn√©es
    const metadata = await extractImageMetadata(imageFile);
    checks.metadataValid = validateImageMetadata(metadata);
    
    // V√©rification 3: D√©tection de doublons
    const imageHash = await generateImageHash(imageFile);
    checks.duplicateCheck = !await isDuplicateImage(imageHash);
    
    // V√©rification 4: Coh√©rence temporelle
    if (analysis.datetime && metadata.timestamp) {
        const timeDiff = Math.abs(
            new Date(metadata.timestamp) - parseTransactionTime(analysis.datetime)
        );
        checks.timeConsistency = timeDiff < 5 * 60 * 1000; // 5 minutes
    }
    
    // Score global
    checks.overallScore = 
        (checks.imageQuality ? 25 : 0) +
        (checks.metadataValid ? 25 : 0) +
        (checks.duplicateCheck ? 25 : 0) +
        (checks.timeConsistency ? 25 : 0);
    
    return checks;
}

// Fonctions utilitaires pour la d√©tection anti-fraude
async function checkImageQuality(imageFile) {
    return new Promise((resolve) => {
        const img = new Image();
        img.onload = function() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);
            
            const imageData = ctx.getImageData(0, 0, img.width, img.height);
            const data = imageData.data;
            
            // Calculer la nettet√© (variance des gradients)
            let sharpness = 0;
            for (let i = 0; i < data.length - 4; i += 4) {
                const gray1 = data[i] * 0.299 + data[i+1] * 0.587 + data[i+2] * 0.114;
                const gray2 = data[i+4] * 0.299 + data[i+5] * 0.587 + data[i+6] * 0.114;
                sharpness += Math.abs(gray1 - gray2);
            }
            
            resolve({ score: Math.min(sharpness / (img.width * img.height * 100), 1) });
        };
        img.src = URL.createObjectURL(imageFile);
    });
}

async function extractImageMetadata(imageFile) {
    // Simulation de l'extraction de m√©tadonn√©es
    return {
        timestamp: imageFile.lastModified,
        size: imageFile.size,
        type: imageFile.type
    };
}

function validateImageMetadata(metadata) {
    const now = Date.now();
    const imageAge = now - metadata.timestamp;
    
    // L'image doit √™tre r√©cente (moins de 1 heure)
    return imageAge < 60 * 60 * 1000 && metadata.size > 10000;
}

async function generateImageHash(imageFile) {
    const arrayBuffer = await imageFile.arrayBuffer();
    const hashBuffer = await crypto.subtle.digest('SHA-256', arrayBuffer);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
}

async function isDuplicateImage(imageHash) {
    // V√©rifier dans localStorage si cette image a d√©j√† √©t√© utilis√©e
    const usedHashes = JSON.parse(localStorage.getItem('usedImageHashes') || '[]');
    if (usedHashes.includes(imageHash)) {
        return true;
    }
    
    // Sauvegarder ce hash
    usedHashes.push(imageHash);
    if (usedHashes.length > 100) {
        usedHashes.shift(); // Garder seulement les 100 derniers
    }
    localStorage.setItem('usedImageHashes', JSON.stringify(usedHashes));
    return false;
}

function parseTransactionTime(timeString) {
    // Parser diff√©rents formats de date/heure
    const formats = [
        /(\d{1,2})\/(\d{1,2})\/(\d{2,4})\s+(\d{1,2}):(\d{2})/,
        /(\d{1,2})-(\d{1,2})-(\d{2,4})\s+(\d{1,2})h(\d{2})/
    ];
    
    for (const format of formats) {
        const match = timeString.match(format);
        if (match) {
            const [, day, month, year, hour, minute] = match;
            const fullYear = year.length === 2 ? 2000 + parseInt(year) : parseInt(year);
            return new Date(fullYear, parseInt(month) - 1, parseInt(day), parseInt(hour), parseInt(minute));
        }
    }
    return null;
}

// Affichage des r√©sultats
function displayVerificationResults(analysis, fraudCheck) {
    const verificationDetails = document.getElementById('verification-details');
    const verificationStatus = document.getElementById('verification-status');
    
    verificationDetails.style.display = 'block';
    
    // Mise √† jour des d√©tails
    updateVerificationDetail('transaction-id', analysis.transactionId, analysis.transactionId ? 'valid' : 'invalid');
    updateVerificationDetail('amount-found', analysis.amount ? `${analysis.amount} FCFA` : 'Non trouv√©', 
                           Math.abs(analysis.amount - currentOrderData.total) <= 10 ? 'valid' : 'invalid');
    updateVerificationDetail('recipient-found', analysis.recipient || 'Non trouv√©', 
                           analysis.recipient && analysis.recipient.toUpperCase().includes('GROUPE EXPRESS') ? 'valid' : 'invalid');
    updateVerificationDetail('datetime-found', analysis.datetime || 'Non trouv√©', analysis.datetime ? 'valid' : 'invalid');
    
    // Score final
    const totalScore = analysis.validationScore + fraudCheck.overallScore;
    const isValid = totalScore >= 70 && fraudCheck.duplicateCheck;
    
    nextStep(4);
    
    if (isValid) {
        showSuccessResult();
    } else {
        showErrorResult(totalScore, fraudCheck);
    }
}

function updateVerificationDetail(elementId, value, status) {
    document.getElementById(elementId).textContent = value;
    const statusIcon = document.getElementById(elementId.replace('-found', '-status'));
    statusIcon.textContent = status === 'valid' ? '‚úÖ' : '‚ùå';
    statusIcon.className = `status-icon ${status}`;
}

function showSuccessResult() {
    document.getElementById('result-title').textContent = 'Paiement V√©rifi√© !';
    document.getElementById('result-subtitle').textContent = 'Votre paiement a √©t√© valid√© avec succ√®s';
    document.getElementById('final-status').className = 'verification-status success';
    document.getElementById('final-status').textContent = '‚úÖ Paiement authentifi√© et valid√©';
    document.getElementById('success-actions').style.display = 'block';
    document.getElementById('error-actions').style.display = 'none';
}

function showErrorResult(score, fraudCheck) {
    document.getElementById('result-title').textContent = 'V√©rification √âchou√©e';
    document.getElementById('result-subtitle').textContent = `Score: ${score}/100 - Minimum requis: 70`;
    document.getElementById('final-status').className = 'verification-status error';
    
    let errorMessage = '‚ùå V√©rification √©chou√©e:\n';
    if (!fraudCheck.duplicateCheck) errorMessage += '‚Ä¢ Image d√©j√† utilis√©e\n';
    if (!fraudCheck.imageQuality) errorMessage += '‚Ä¢ Qualit√© d\'image insuffisante\n';
    if (score < 70) errorMessage += '‚Ä¢ Informations incompl√®tes ou incorrectes\n';
    
    document.getElementById('final-status').textContent = errorMessage;
    document.getElementById('success-actions').style.display = 'none';
    document.getElementById('error-actions').style.display = 'block';
}

function showErrorActions() {
    document.getElementById('error-actions').style.display = 'block';
    document.getElementById('success-actions').style.display = 'none';
}

function contactSupport() {
    window.open('https://wa.me/2250719983044?text=Bonjour%20j%27ai%20un%20probl√®me%20avec%20la%20v√©rification%20de%20paiement%20Wave', '_blank');
}

// Gestionnaire d'upload d'image am√©lior√©
document.addEventListener('DOMContentLoaded', function() {
    const screenshotInput = document.getElementById('screenshot-input');
    const uploadArea = document.querySelector('.upload-area');
    const previewContainer = document.getElementById('preview-container');
    const previewImage = document.getElementById('preview-image');
    const verifyBtn = document.getElementById('verify-btn');
    
    if (screenshotInput) {
        screenshotInput.addEventListener('change', handleImageUpload);
    }
    
    if (uploadArea) {
        uploadArea.addEventListener('dragover', handleDragOver);
        uploadArea.addEventListener('drop', handleDrop);
    }
});

function handleImageUpload(e) {
    const file = e.target.files[0];
    if (file && file.type.startsWith('image/')) {
        displayImagePreview(file);
    }
}

function handleDragOver(e) {
    e.preventDefault();
    e.currentTarget.classList.add('dragover');
}

function handleDrop(e) {
    e.preventDefault();
    e.currentTarget.classList.remove('dragover');
    
    const files = e.dataTransfer.files;
    if (files.length > 0 && files[0].type.startsWith('image/')) {
        document.getElementById('screenshot-input').files = files;
        displayImagePreview(files[0]);
    }
}

function displayImagePreview(file) {
    const uploadArea = document.querySelector('.upload-area');
    const previewContainer = document.getElementById('preview-container');
    const previewImage = document.getElementById('preview-image');
    const verifyBtn = document.getElementById('verify-btn');
    
    uploadArea.classList.add('has-file');
    
    const reader = new FileReader();
    reader.onload = function(e) {
        previewImage.src = e.target.result;
        previewContainer.style.display = 'block';
        verifyBtn.disabled = false;
    };
    reader.readAsDataURL(file);
}
    </script>
</body>
</html>

