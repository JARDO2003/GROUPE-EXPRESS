<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Commandes - GROUPE EXPRESS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-main: #e0e5ec;
            --shadow-dark: #a3b1c6;
            --shadow-light: #ffffff;
            --primary: #667eea;
            --primary-dark: #5568d3;
            --success: #4ade80;
            --danger: #f87171;
            --warning: #fbbf24;
            --text-dark: #2d3748;
            --text-light: #718096;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg-main);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-dark);
        }

        .neomorph {
            background: var(--bg-main);
            box-shadow: 8px 8px 16px var(--shadow-dark),
                        -8px -8px 16px var(--shadow-light);
            border-radius: 20px;
        }

        .neomorph-inset {
            background: var(--bg-main);
            box-shadow: inset 6px 6px 12px var(--shadow-dark),
                        inset -6px -6px 12px var(--shadow-light);
            border-radius: 15px;
        }

        .neomorph-flat {
            background: var(--bg-main);
            box-shadow: 4px 4px 8px var(--shadow-dark),
                        -4px -4px 8px var(--shadow-light);
            border-radius: 15px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* √âcran de s√©lection d'√©tablissement */
        .establishment-selector {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: var(--bg-main);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .establishment-selector.hidden {
            display: none;
        }

        .selector-card {
            max-width: 600px;
            width: 100%;
            padding: 3rem;
            text-align: center;
        }

        .selector-card h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--text-dark);
        }

        .selector-card p {
            font-size: 1.1rem;
            color: var(--text-light);
            margin-bottom: 2rem;
        }

        .establishments-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .establishment-btn {
            padding: 2rem 1rem;
            background: var(--bg-main);
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .establishment-btn:hover {
            transform: translateY(-5px);
            box-shadow: 10px 10px 20px var(--shadow-dark),
                        -10px -10px 20px var(--shadow-light);
        }

        .establishment-btn:active {
            box-shadow: inset 4px 4px 8px var(--shadow-dark),
                        inset -4px -4px 8px var(--shadow-light);
        }

        /* Header */
        .header {
            padding: 2rem;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .header-logo {
            width: 70px;
            height: 70px;
            background: linear-gradient(145deg, #667eea, #764ba2);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            box-shadow: 8px 8px 16px var(--shadow-dark),
                        -8px -8px 16px var(--shadow-light);
        }

        .header-info h1 {
            font-size: 1.8rem;
            margin-bottom: 0.3rem;
        }

        .establishment-tag {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--bg-main);
            box-shadow: inset 3px 3px 6px var(--shadow-dark),
                        inset -3px -3px 6px var(--shadow-light);
            border-radius: 20px;
            font-size: 0.9rem;
            color: var(--text-light);
            font-weight: 600;
        }

        .change-establishment-btn {
            padding: 0.75rem 1.5rem;
            background: var(--bg-main);
            border: none;
            border-radius: 25px;
            font-weight: 600;
            color: var(--primary);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 6px 6px 12px var(--shadow-dark),
                        -6px -6px 12px var(--shadow-light);
        }

        .change-establishment-btn:hover {
            box-shadow: 8px 8px 16px var(--shadow-dark),
                        -8px -8px 16px var(--shadow-light);
        }

        .change-establishment-btn:active {
            box-shadow: inset 4px 4px 8px var(--shadow-dark),
                        inset -4px -4px 8px var(--shadow-light);
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .stat-header {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            background: var(--bg-main);
            box-shadow: inset 4px 4px 8px var(--shadow-dark),
                        inset -4px -4px 8px var(--shadow-light);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
        }

        .stat-info h3 {
            font-size: 0.9rem;
            color: var(--text-light);
            font-weight: 500;
        }

        .stat-info p {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-top: 0.5rem;
        }

        /* Filters */
        .filters {
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .filter-group label {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.95rem;
        }

        .filter-select, .search-input {
            padding: 0.75rem 1.2rem;
            background: var(--bg-main);
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            color: var(--text-dark);
            box-shadow: inset 4px 4px 8px var(--shadow-dark),
                        inset -4px -4px 8px var(--shadow-light);
            outline: none;
            transition: all 0.3s ease;
        }

        .filter-select:focus, .search-input:focus {
            box-shadow: inset 6px 6px 12px var(--shadow-dark),
                        inset -6px -6px 12px var(--shadow-light);
        }

        /* Orders */
        .orders-container {
            padding: 2rem;
        }

        .orders-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
        }

        .orders-header h2 {
            font-size: 1.5rem;
            color: var(--text-dark);
        }

        .refresh-btn {
            padding: 0.75rem 1.5rem;
            background: var(--bg-main);
            border: none;
            border-radius: 25px;
            font-weight: 600;
            color: var(--primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 6px 6px 12px var(--shadow-dark),
                        -6px -6px 12px var(--shadow-light);
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            box-shadow: 8px 8px 16px var(--shadow-dark),
                        -8px -8px 16px var(--shadow-light);
        }

        .order-card {
            padding: 2rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
        }

        .order-card:hover {
            box-shadow: 10px 10px 20px var(--shadow-dark),
                        -10px -10px 20px var(--shadow-light);
        }

        .order-card.delivered {
            opacity: 0.6;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .order-code {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .order-status {
            padding: 0.5rem 1.2rem;
            background: var(--bg-main);
            box-shadow: inset 3px 3px 6px var(--shadow-dark),
                        inset -3px -3px 6px var(--shadow-light);
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-nouveau {
            color: var(--warning);
        }

        .status-livre {
            color: var(--success);
        }

        .order-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .detail-item {
            padding: 1rem;
            background: var(--bg-main);
            box-shadow: inset 3px 3px 6px var(--shadow-dark),
                        inset -3px -3px 6px var(--shadow-light);
            border-radius: 12px;
        }

        .detail-item h4 {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }

        .detail-item p {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .order-items {
            padding: 1.5rem;
            background: var(--bg-main);
            box-shadow: inset 4px 4px 8px var(--shadow-dark),
                        inset -4px -4px 8px var(--shadow-light);
            border-radius: 15px;
            margin-bottom: 1.5rem;
        }

        .order-items h4 {
            font-size: 0.95rem;
            color: var(--text-light);
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .item-list {
            list-style: none;
        }

        .item-list li {
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(163, 177, 198, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .item-list li:last-child {
            border-bottom: none;
        }

        .item-name {
            font-weight: 600;
            color: var(--text-dark);
        }

        .item-category {
            background: var(--primary);
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 8px;
            font-size: 0.75rem;
            margin-left: 0.5rem;
        }

        .order-total {
            padding: 1.5rem;
            background: linear-gradient(145deg, var(--primary), var(--primary-dark));
            color: white;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            border-radius: 15px;
            box-shadow: 6px 6px 12px var(--shadow-dark),
                        -6px -6px 12px var(--shadow-light);
        }

        .order-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.9rem 1.5rem;
            background: var(--bg-main);
            border: none;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
            justify-content: center;
            min-width: 150px;
            box-shadow: 6px 6px 12px var(--shadow-dark),
                        -6px -6px 12px var(--shadow-light);
        }

        .btn:hover {
            box-shadow: 8px 8px 16px var(--shadow-dark),
                        -8px -8px 16px var(--shadow-light);
        }

        .btn:active {
            box-shadow: inset 4px 4px 8px var(--shadow-dark),
                        inset -4px -4px 8px var(--shadow-light);
        }

        .btn-deliver {
            color: var(--success);
        }

        .btn-delete {
            color: var(--danger);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--bg-main);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
            box-shadow: 4px 4px 8px var(--shadow-dark),
                        -4px -4px 8px var(--shadow-light);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-light);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--bg-main);
            padding: 1rem 1.5rem;
            border-radius: 15px;
            box-shadow: 8px 8px 16px var(--shadow-dark),
                        -8px -8px 16px var(--shadow-light);
            display: flex;
            align-items: center;
            gap: 1rem;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            .establishments-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .filters {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-group {
                flex-direction: column;
                align-items: stretch;
            }

            .order-actions {
                flex-direction: column;
            }

            .btn {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- S√©lecteur d'√©tablissement -->
    <div class="establishment-selector" id="establishment-selector">
        <div class="selector-card neomorph">
            <h1>üè¢ S√©lectionnez un √©tablissement</h1>
            <p>Choisissez l'√©tablissement dont vous souhaitez consulter les commandes</p>
            <div class="establishments-grid">
                <button class="establishment-btn neomorph-flat" data-establishment="UTT LOKO ZONE4C">
                    UTT LOKO ZONE4C
                </button>
                <button class="establishment-btn neomorph-flat" data-establishment="LA FONTAINE">
                    LA FONTAINE
                </button>
            </div>
        </div>
    </div>

    <div class="container" id="main-content" style="display: none;">
        <!-- Header -->
        <div class="header neomorph">
            <div class="header-left">
                <div class="header-logo">üçΩÔ∏è</div>
                <div class="header-info">
                    <h1>Dashboard Commandes</h1>
                    <div class="establishment-tag">
                        <span>üìç</span>
                        <span id="current-establishment">-</span>
                    </div>
                </div>
            </div>
            <button class="change-establishment-btn" id="change-establishment-btn">
                üîÑ Changer d'√©tablissement
            </button>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card neomorph">
                <div class="stat-header">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-info">
                        <h3>Revenu du jour</h3>
                        <p id="today-revenue">0 FCFA</p>
                    </div>
                </div>
            </div>
            <div class="stat-card neomorph">
                <div class="stat-header">
                    <div class="stat-icon">‚è≥</div>
                    <div class="stat-info">
                        <h3>En attente</h3>
                        <p id="pending-count">0</p>
                    </div>
                </div>
            </div>
            <div class="stat-card neomorph">
                <div class="stat-header">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-info">
                        <h3>Livr√©es aujourd'hui</h3>
                        <p id="delivered-count">0</p>
                    </div>
                </div>
            </div>
            <div class="stat-card neomorph">
                <div class="stat-header">
                    <div class="stat-icon">üì¶</div>
                    <div class="stat-info">
                        <h3>Total commandes</h3>
                        <p id="total-count">0</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters neomorph">
            <div class="filter-group">
                <label>üìÖ Date:</label>
                <input type="date" class="filter-select" id="date-filter">
            </div>
            <div class="filter-group">
                <label>üìä Statut:</label>
                <select class="filter-select" id="status-filter">
                    <option value="all">Tous</option>
                    <option value="En attente">En attente</option>
                    <option value="livre">Livr√©es</option>
                </select>
            </div>
            <div class="filter-group">
                <label>üîç Rechercher:</label>
                <input type="text" class="search-input" id="search-input" placeholder="Client, code...">
            </div>
        </div>

        <!-- Orders -->
        <div class="orders-container neomorph">
            <div class="orders-header">
                <h2>üìã Liste des commandes</h2>
                <button class="refresh-btn" id="refresh-btn">
                    üîÑ Actualiser
                </button>
            </div>
            <div id="orders-list">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Chargement des commandes...</p>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBsGrY-AqYMoI70kT3WMxLgW0HwYA4KyaQ",
            authDomain: "livraison-c8498.firebaseapp.com",
            projectId: "livraison-c8498",
            storageBucket: "livraison-c8498.firebasestorage.app",
            messagingSenderId: "403240604780",
            appId: "1:403240604780:web:77d84ad03d68bdaddfb449",
            measurementId: "G-5YF89BZ5RY"
        };

        let app, db;
        let allOrders = [];
        let selectedEstablishment = localStorage.getItem('selectedEstablishment');

        // Initialisation Firebase
        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            console.log('‚úÖ Firebase initialis√©');
        } catch (error) {
            console.error('‚ùå Erreur Firebase:', error);
        }

        // Gestion de la s√©lection d'√©tablissement
        if (selectedEstablishment) {
            showDashboard();
        } else {
            showEstablishmentSelector();
        }

        document.querySelectorAll('.establishment-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                selectedEstablishment = btn.dataset.establishment;
                localStorage.setItem('selectedEstablishment', selectedEstablishment);
                showDashboard();
            });
        });

        document.getElementById('change-establishment-btn').addEventListener('click', () => {
            showEstablishmentSelector();
        });

        function showEstablishmentSelector() {
            document.getElementById('establishment-selector').classList.remove('hidden');
            document.getElementById('main-content').style.display = 'none';
        }

        function showDashboard() {
            document.getElementById('establishment-selector').classList.add('hidden');
            document.getElementById('main-content').style.display = 'block';
            document.getElementById('current-establishment').textContent = selectedEstablishment;
            loadOrders();
        }

        function getTodayDate() {
            return new Date().toISOString().split('T')[0];
        }

        function loadOrders() {
            if (!db) return;

            try {
                onSnapshot(collection(db, 'orders'), (snapshot) => {
                    allOrders = [];
                    snapshot.forEach((docSnap) => {
                        const data = docSnap.data();
                        
                        console.log('üì¶ Document:', docSnap.id, 'Establishment:', data.establishment, 'Selected:', selectedEstablishment);
                        
                        // Filtrer par √©tablissement (v√©rification exacte)
                        if (data.establishment !== selectedEstablishment) {
                            return;
                        }

                        console.log('‚úÖ Commande ajout√©e:', docSnap.id);

                        allOrders.push({
                            id: docSnap.id,
                            customerName: data.customerName || 'N/A',
                            whatsappNumber: data.whatsappNumber || 'N/A',
                            establishment: data.establishment || 'N/A',
                            createdAt: data.createdAt || null,
                            timestamp: data.timestamp || null,
                            status: data.status || 'En attente',
                            total: data.total || 0,
                            items: data.items || []
                        });
                    });

                    console.log(`üìä Total commandes pour ${selectedEstablishment}:`, allOrders.length);

                    allOrders.sort((a, b) => {
                        const dateA = a.createdAt ? new Date(a.createdAt).getTime() : 0;
                        const dateB = b.createdAt ? new Date(b.createdAt).getTime() : 0;
                        return dateB - dateA;
                    });

                    filterOrders();
                });
            } catch (error) {
                console.error('‚ùå Erreur:', error);
            }
        }

        function filterOrders() {
            const dateFilter = document.getElementById('date-filter').value;
            const statusFilter = document.getElementById('status-filter').value;
            const searchTerm = document.getElementById('search-input').value.toLowerCase();

            let filtered = [...allOrders];

            if (dateFilter) {
                filtered = filtered.filter(order => {
                    const orderDate = order.createdAt 
                        ? new Date(order.createdAt).toISOString().split('T')[0]
                        : '';
                    return orderDate === dateFilter;
                });
            }

            if (statusFilter !== 'all') {
                filtered = filtered.filter(order => order.status === statusFilter);
            }

            if (searchTerm) {
                filtered = filtered.filter(order => 
                    order.customerName.toLowerCase().includes(searchTerm) ||
                    order.id.toLowerCase().includes(searchTerm)
                );
            }

            displayOrders(filtered);
            updateStats();
        }

        function displayOrders(orders) {
            const ordersList = document.getElementById('orders-list');

            if (orders.length === 0) {
                ordersList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì¶</div>
                        <h3>Aucune commande</h3>
                        <p>Aucune commande trouv√©e pour cet √©tablissement</p>
                    </div>
                `;
                return;
            }

            ordersList.innerHTML = orders.map(order => {
                const date = order.createdAt ? new Date(order.createdAt) : new Date();
                const formattedDate = date.toLocaleDateString('fr-FR');
                const formattedTime = date.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
                const isDelivered = order.status === 'livre';

                return `
                    <div class="order-card neomorph-flat ${isDelivered ? 'delivered' : ''}">
                        <div class="order-header">
                            <div class="order-code">üì¶ ${order.id}</div>
                            <span class="order-status status-${order.status === 'En attente' ? 'nouveau' : 'livre'}">
                                ${order.status === 'En attente' ? '‚è≥ En attente' : '‚úÖ Livr√©e'}
                            </span>
                        </div>

                        <div class="order-details">
                            <div class="detail-item">
                                <h4>üë§ Client</h4>
                                <p>${order.customerName}</p>
                            </div>
                            <div class="detail-item">
                                <h4>üì± WhatsApp</h4>
                                <p>${order.whatsappNumber}</p>
                            </div>
                            <div class="detail-item">
                                <h4>üìÖ Date</h4>
                                <p>${formattedDate}</p>
                            </div>
                            <div class="detail-item">
                                <h4>‚è∞ Heure</h4>
                                <p>${formattedTime}</p>
                            </div>
                        </div>

                        <div class="order-items">
                            <h4>üìã Articles (${order.items.length})</h4>
                            <ul class="item-list">
                                ${order.items.map(item => `
                                    <li>
                                        <span>
                                            <span class="item-name">${item.quantity || 1}x ${item.name || 'Article'}</span>
                                            <span class="item-category">${item.category || 'N/A'}</span>
                                        </span>
                                        <strong>${((item.price || 0) * (item.quantity || 1)).toLocaleString()} FCFA</strong>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>

                        <div class="order-total">
                            üí∞ Total: ${order.total.toLocaleString()} FCFA
                        </div>

                        <div class="order-actions">
                            <button class="btn btn-deliver" 
                                    data-order-id="${order.id}"
                                    data-order-total="${order.total}"
                                    ${isDelivered ? 'disabled' : ''}>
                                ${isDelivered ? '‚úÖ D√©j√† livr√©e' : 'üöö Marquer comme livr√©e'}
                            </button>
                            <button class="btn btn-delete" 
                                    data-order-id="${order.id}">
                                üóëÔ∏è Supprimer
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            // Attacher les √©v√©nements
            document.querySelectorAll('.btn-deliver').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (!btn.disabled) {
                        markAsDelivered(btn.dataset.orderId, parseFloat(btn.dataset.orderTotal));
                    }
                });
            });

            document.querySelectorAll('.btn-delete').forEach(btn => {
                btn.addEventListener('click', () => {
                    deleteOrder(btn.dataset.orderId);
                });
            });
        }

        async function markAsDelivered(orderId, orderTotal) {
            if (!confirm('Confirmer la livraison de cette commande ?')) return;

            try {
                await updateDoc(doc(db, 'orders', orderId), {
                    status: 'livre',
                    deliveredAt: new Date().toISOString()
                });

                const today = getTodayDate();
                const dailyRevenue = JSON.parse(localStorage.getItem('dailyRevenue') || '{}');
                if (!dailyRevenue[today]) {
                    dailyRevenue[today] = 0;
                }
                dailyRevenue[today] += orderTotal;
                localStorage.setItem('dailyRevenue', JSON.stringify(dailyRevenue));

                showToast('‚úÖ Commande marqu√©e comme livr√©e !', 'success');
                updateStats();
            } catch (error) {
                console.error('Erreur:', error);
                showToast('‚ùå Erreur lors de la mise √† jour', 'error');
            }
        }

        async function deleteOrder(orderId) {
            const password = prompt('Entrez le mot de passe pour supprimer cette commande :');
            
            if (!password) {
                return; // Annul√©
            }
            
            if (password !== 'marcio@') {
                showToast('‚ùå Mot de passe incorrect !', 'error');
                return;
            }

            try {
                await deleteDoc(doc(db, 'orders', orderId));
                showToast('‚úÖ Commande supprim√©e !', 'success');
            } catch (error) {
                console.error('Erreur:', error);
                showToast('‚ùå Erreur lors de la suppression', 'error');
            }
        }

        function updateStats() {
            const today = getTodayDate();
            const dailyRevenue = JSON.parse(localStorage.getItem('dailyRevenue') || '{}');

            const todayOrders = allOrders.filter(order => {
                const orderDate = order.createdAt 
                    ? new Date(order.createdAt).toISOString().split('T')[0]
                    : '';
                return orderDate === today;
            });

            const pendingOrders = allOrders.filter(order => order.status === 'En attente');
            const deliveredToday = todayOrders.filter(order => order.status === 'livre');

            document.getElementById('today-revenue').textContent = 
                (dailyRevenue[today] || 0).toLocaleString() + ' FCFA';
            document.getElementById('pending-count').textContent = pendingOrders.length;
            document.getElementById('delivered-count').textContent = deliveredToday.length;
            document.getElementById('total-count').textContent = allOrders.length;
        }

        function showToast(message, type) {
            const existingToasts = document.querySelectorAll('.toast');
            existingToasts.forEach(toast => toast.remove());

            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `
                <div style="font-size: 1.5rem;">${type === 'success' ? '‚úÖ' : '‚ùå'}</div>
                <div>${message}</div>
            `;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Event listeners
        document.getElementById('date-filter').addEventListener('change', filterOrders);
        document.getElementById('status-filter').addEventListener('change', filterOrders);
        document.getElementById('search-input').addEventListener('input', filterOrders);
        document.getElementById('refresh-btn').addEventListener('click', () => location.reload());
    </script>
</body>
</html>
